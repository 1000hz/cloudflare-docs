{"data":{"mdx":{"id":"c26a2fe1-5d96-5022-95b5-b6505df2126d","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"order\": 11,\n  \"pcx-content-type\": \"interim\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"understanding-the-basics\"\n  }, \"Understanding the basics\"), mdx(\"h2\", {\n    \"id\": \"access-pattern\"\n  }, \"Access pattern\"), mdx(\"p\", null, \"The basic access pattern is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"give me all the logs for zone Z for minute M\"), \" where the minute \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"M\"), \" refers to the time the log entries were written to disk in Cloudflare's log aggregation system.\"), mdx(\"p\", null, \"To start, try running your query every minute. If responses are too small, go up to 5 minutes as this will be appropriate for most zones. If the responses are too large, try going down to 15 seconds.\"), mdx(\"p\", null, \"If your zone has so many logs that it takes longer than 1 minute to read 1 minute worth of logs, run 2 workers staggered, each requesting 1 minute worth of logs every 2 minutes.\"), mdx(\"p\", null, \"Data returned by the API will not change on repeat calls. The order of messages in the response may be different, but the number and content of the messages will always be the same for a given query as long as the response code is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"200\"), \" and there is no error reading the response body.\"), mdx(\"p\", null, \"Because our log processing system ingests data in batches, most zones with less than 1 million requests per minute will have \\\"empty\\\" minutes. Queries for such a minute result in responses with status \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"200\"), \" but no data in the body. This does not mean that there were no requests proxied by Cloudflare for that minute. It just means that our system did not process a batch of logs for that zone in that minute.\"), mdx(\"h2\", {\n    \"id\": \"order-of-the-data-returned\"\n  }, \"Order of the data returned\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"logs/received\"), \" API endpoint exposes data by time received, which is the time the event was written to disk in the Cloudflare Logs aggregation system.\"), mdx(\"p\", null, \"Ordering by log aggregation time instead of log generation time results in lower (faster) log pipeline latency and deterministic log pulls. Functionally, it is similar to tailing a log file or reading from \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"rsyslog\"), \" (albeit in chunks).\"), mdx(\"p\", null, \"This means that to obtain logs for a given time range, you can issue one call for each consecutive minute (or other time range). Because log lines are batched by time received and made available, there is no late arriving data. A response for a given minute will never change. You do not have to repeatedly poll a given time range to receive logs as they converge on our aggregation system.\"), mdx(\"h2\", {\n    \"id\": \"format-of-the-data-returned\"\n  }, \"Format of the data returned\"), mdx(\"p\", null, \"The Logpull API returns data in NDJSON format, whereby each log line is a valid JSON object. Major analysis tools like Google BigQuery and AWS Kinesis require this format.\"), mdx(\"p\", null, \"To turn the resulting log data into a JSON array with one array element per log line, you can use the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"jq\"), \" tool.  Essentially, you pipe the API response into \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"jq\"), \" using the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"slurp\"), \" (or simply \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"s\"), \") flag:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<API request data> | jq -s\")), mdx(\"p\", null, \"The following is a sample log with default fields:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"{\\n    \\\"ClientIP\\\": \\\"89.163.242.206\\\",\\n    \\\"ClientRequestHost\\\": \\\"www.theburritobot.com\\\",\\n    \\\"ClientRequestMethod\\\": \\\"GET\\\",\\n    \\\"ClientRequestURI\\\": \\\"/static/img/testimonial-hipster.png\\\",\\n    \\\"EdgeEndTimestamp\\\": 1506702504461999900,\\n    \\\"EdgeResponseBytes\\\": 69045,\\n    \\\"EdgeResponseStatus\\\": 200,\\n    \\\"EdgeStartTimestamp\\\": 1506702504433000200,\\n    \\\"RayID\\\": \\\"3a6050bcbe121a87\\\"\\n}\\n\")), mdx(\"h2\", {\n    \"id\": \"data-retention-period\"\n  }, \"Data retention period\"), mdx(\"p\", null, \"You can query for logs starting from 1 minute in the past (relative to the actual time that you make the query) and go back at least 3 days and up to 7 days.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"","type":null,"updated":null}}},"pageContext":{"id":"c26a2fe1-5d96-5022-95b5-b6505df2126d","fields":{"slug":"/logpull/understanding-the-basics"},"frontmatter":{"pcx_content_type":"interim","title":"","type":null,"order":11,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Understanding the basics","depth":1}],"tableOfContents":{"items":[{"url":"#understanding-the-basics","title":"Understanding the basics","items":[{"url":"#access-pattern","title":"Access pattern"},{"url":"#order-of-the-data-returned","title":"Order of the data returned"},{"url":"#format-of-the-data-returned","title":"Format of the data returned"},{"url":"#data-retention-period","title":"Data retention period"}]}]},"parent":{"modifiedTime":"2022-01-27","relativePath":"logpull/understanding-the-basics/index.md"}}}