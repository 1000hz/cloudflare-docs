{"expireTime":9007200898048139000,"key":"gatsby-plugin-mdx-entire-payload-f3b1241b7a8ef986f0177745a5ecfbdf-","val":{"mdast":{"type":"root","children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"Parse Cloudflare Logs JSON data","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":34,"offset":34},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":34,"offset":34},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Overview","position":{"start":{"line":4,"column":4,"offset":39},"end":{"line":4,"column":12,"offset":47},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":36},"end":{"line":4,"column":12,"offset":47},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After downloading your Cloudflare Logs data, you can use different tools to parse and analyze your logs.","position":{"start":{"line":6,"column":1,"offset":49},"end":{"line":6,"column":105,"offset":153},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":49},"end":{"line":6,"column":105,"offset":153},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In this tutorial, you will learn how to parse your JSON log data using ","position":{"start":{"line":8,"column":1,"offset":155},"end":{"line":8,"column":72,"offset":226},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"jq","position":{"start":{"line":8,"column":73,"offset":227},"end":{"line":8,"column":75,"offset":229},"indent":[]}}],"position":{"start":{"line":8,"column":72,"offset":226},"end":{"line":8,"column":76,"offset":230},"indent":[]}},{"type":"text","value":".  To get started with ","position":{"start":{"line":8,"column":76,"offset":230},"end":{"line":8,"column":99,"offset":253},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"jq","position":{"start":{"line":8,"column":100,"offset":254},"end":{"line":8,"column":102,"offset":256},"indent":[]}}],"position":{"start":{"line":8,"column":99,"offset":253},"end":{"line":8,"column":103,"offset":257},"indent":[]}},{"type":"text","value":", visit the ","position":{"start":{"line":8,"column":103,"offset":257},"end":{"line":8,"column":115,"offset":269},"indent":[]}},{"type":"link","title":null,"url":"https://stedolan.github.io/jq/","children":[{"type":"emphasis","children":[{"type":"text","value":"jq","position":{"start":{"line":8,"column":117,"offset":271},"end":{"line":8,"column":119,"offset":273},"indent":[]}}],"position":{"start":{"line":8,"column":116,"offset":270},"end":{"line":8,"column":120,"offset":274},"indent":[]}},{"type":"text","value":" official site","position":{"start":{"line":8,"column":120,"offset":274},"end":{"line":8,"column":134,"offset":288},"indent":[]}}],"position":{"start":{"line":8,"column":115,"offset":269},"end":{"line":8,"column":167,"offset":321},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":8,"column":167,"offset":321},"end":{"line":8,"column":168,"offset":322},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":155},"end":{"line":8,"column":168,"offset":322},"indent":[]}},{"type":"jsx","value":"<Aside type=\"note\" header=\"Note\">","position":{"start":{"line":10,"column":1,"offset":324},"end":{"line":10,"column":34,"offset":357},"indent":[]}},{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"jq","position":{"start":{"line":12,"column":2,"offset":360},"end":{"line":12,"column":4,"offset":362},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":359},"end":{"line":12,"column":5,"offset":363},"indent":[]}},{"type":"text","value":" is a powerful command line for parsing JSON data and performing certain types of analysis. To perform more detailed analysis, consider a full-fledged data analysis system, such as ","position":{"start":{"line":12,"column":5,"offset":363},"end":{"line":12,"column":186,"offset":544},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"Kibana","position":{"start":{"line":12,"column":187,"offset":545},"end":{"line":12,"column":193,"offset":551},"indent":[]}}],"position":{"start":{"line":12,"column":186,"offset":544},"end":{"line":12,"column":194,"offset":552},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":12,"column":194,"offset":552},"end":{"line":12,"column":195,"offset":553},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":359},"end":{"line":12,"column":195,"offset":553},"indent":[]}},{"type":"jsx","value":"</Aside>","position":{"start":{"line":13,"column":1,"offset":554},"end":{"line":13,"column":9,"offset":562},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Aggregating fields","position":{"start":{"line":15,"column":4,"offset":567},"end":{"line":15,"column":22,"offset":585},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":564},"end":{"line":15,"column":22,"offset":585},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To aggregate a field appearing in the log, such as by IP address, URI, or referrer, you can use several ","position":{"start":{"line":17,"column":1,"offset":587},"end":{"line":17,"column":105,"offset":691},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"jq","position":{"start":{"line":17,"column":106,"offset":692},"end":{"line":17,"column":108,"offset":694},"indent":[]}}],"position":{"start":{"line":17,"column":105,"offset":691},"end":{"line":17,"column":109,"offset":695},"indent":[]}},{"type":"text","value":" commands. This is useful to identify any patterns in traffic; for example, to identify your most popular pages or to block an attack.","position":{"start":{"line":17,"column":109,"offset":695},"end":{"line":17,"column":243,"offset":829},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":587},"end":{"line":17,"column":243,"offset":829},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The following examples match on a field name and provide a count of each field instance, sorted in ascending order by count.","position":{"start":{"line":19,"column":1,"offset":831},"end":{"line":19,"column":125,"offset":955},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":831},"end":{"line":19,"column":125,"offset":955},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq -r .ClientRequestURI logs.json | sort -n | uniq -c | sort -n | tail\n2 /nginx-logo.png\n2 /poweredby.png\n2 /testagain\n3 /favicon.ico\n3 /testing\n3 /testing123\n6 /test\n7 /testing1234\n10 /cdn-cgi/nexp/dok3v=1613a3a185/cloudflare/rocket.js\n54 /","position":{"start":{"line":21,"column":1,"offset":957},"end":{"line":33,"column":4,"offset":1212},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq -r .ClientRequestUserAgent logs.json | sort -n | uniq -c | sort -n | tail\n1 python-requests/2.9.1\n2 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.56 Safari/537.17\n4 Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36\n5 curl/7.47.2-DEV\n36 Mozilla/5.0 (X11; Linux x86_64; rv:44.0) Gecko/20100101 Firefox/44.0\n51 curl/7.46.0-DEV","position":{"start":{"line":35,"column":1,"offset":1214},"end":{"line":43,"column":4,"offset":1667},"indent":[1,1,1,1,1,1,1,1]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq -r .ClientRequestReferer logs.json | sort -n | uniq -c | sort -n | tail\n2 http://example.com/testagain\n3 http://example.com/testing\n5 http://example.com/\n5 http://example.com/testing123\n7 http://example.com/testing1234\n77 null","position":{"start":{"line":45,"column":1,"offset":1669},"end":{"line":53,"column":4,"offset":1912},"indent":[1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Filtering fields","position":{"start":{"line":55,"column":4,"offset":1917},"end":{"line":55,"column":20,"offset":1933},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":1914},"end":{"line":55,"column":20,"offset":1933},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Another common use case involves filtering data for a specific field value and then aggregating after that. This helps answer questions like ","position":{"start":{"line":57,"column":1,"offset":1935},"end":{"line":57,"column":142,"offset":2076},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"Which URLs saw the most 502 errors?","position":{"start":{"line":57,"column":143,"offset":2077},"end":{"line":57,"column":178,"offset":2112},"indent":[]}}],"position":{"start":{"line":57,"column":142,"offset":2076},"end":{"line":57,"column":179,"offset":2113},"indent":[]}},{"type":"text","value":" For example:","position":{"start":{"line":57,"column":179,"offset":2113},"end":{"line":57,"column":192,"offset":2126},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1935},"end":{"line":57,"column":192,"offset":2126},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq 'select(.OriginResponseStatus == 502) | .ClientRequestURI' logs.json | sort -n | uniq -c | sort -n | tail\n1 \"/favicon.ico\"\n1 \"/testing\"\n3 \"/testing123\"\n6 \"/test\"\n6 \"/testing1234\"\n18 \"/\"","position":{"start":{"line":59,"column":1,"offset":2128},"end":{"line":67,"column":4,"offset":2330},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To find out the top IP addresses blocked by the Cloudflare WAF, use the following query:","position":{"start":{"line":69,"column":1,"offset":2332},"end":{"line":69,"column":89,"offset":2420},"indent":[]}}],"position":{"start":{"line":69,"column":1,"offset":2332},"end":{"line":69,"column":89,"offset":2420},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq -r 'select(.WAFAction == \"drop\") | .ClientIP' logs.json | sort -n | uniq -c | sort -n\n1 127.0.0.1","position":{"start":{"line":71,"column":1,"offset":2422},"end":{"line":74,"column":4,"offset":2536},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Showing cached requests","position":{"start":{"line":76,"column":4,"offset":2541},"end":{"line":76,"column":27,"offset":2564},"indent":[]}}],"position":{"start":{"line":76,"column":1,"offset":2538},"end":{"line":76,"column":27,"offset":2564},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To retrieve your cache ratios, try the following query:","position":{"start":{"line":78,"column":1,"offset":2566},"end":{"line":78,"column":56,"offset":2621},"indent":[]}}],"position":{"start":{"line":78,"column":1,"offset":2566},"end":{"line":78,"column":56,"offset":2621},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq -r '.CacheCacheStatus' logs.json | sort -n | uniq -c | sort -n\n3 hit\n3 null\n3 stale\n4 expired\n6 miss\n81 unknown","position":{"start":{"line":80,"column":1,"offset":2623},"end":{"line":88,"column":4,"offset":2751},"indent":[1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Showing TLS versions","position":{"start":{"line":90,"column":4,"offset":2756},"end":{"line":90,"column":24,"offset":2776},"indent":[]}}],"position":{"start":{"line":90,"column":1,"offset":2753},"end":{"line":90,"column":24,"offset":2776},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To find out which TLS versions your visitors are using ","position":{"start":{"line":92,"column":1,"offset":2778},"end":{"line":92,"column":56,"offset":2833},"indent":[]}},{"type":"text","value":"—","position":{"start":{"line":92,"column":56,"offset":2833},"end":{"line":92,"column":63,"offset":2840},"indent":[]}},{"type":"text","value":" for example, to decide if you can disable TLS versions that are older than 1.2 ","position":{"start":{"line":92,"column":63,"offset":2840},"end":{"line":92,"column":143,"offset":2920},"indent":[]}},{"type":"text","value":"—","position":{"start":{"line":92,"column":143,"offset":2920},"end":{"line":92,"column":150,"offset":2927},"indent":[]}},{"type":"text","value":" use the following query:","position":{"start":{"line":92,"column":150,"offset":2927},"end":{"line":92,"column":175,"offset":2952},"indent":[]}}],"position":{"start":{"line":92,"column":1,"offset":2778},"end":{"line":92,"column":175,"offset":2952},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"$ jq -r '.ClientSSLProtocol' logs.json | sort -n | uniq -c | sort -n\n42 none\n58 TLSv1.2","position":{"start":{"line":94,"column":1,"offset":2954},"end":{"line":98,"column":4,"offset":3053},"indent":[1,1,1,1]}},{"type":"export","value":"export const _frontmatter = {\"order\":85,\"pcx-content-type\":\"interim\"}","position":{"start":{"line":100,"column":1,"offset":3055},"end":{"line":100,"column":70,"offset":3124},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":100,"column":70,"offset":3124}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"order\": 85,\n  \"pcx-content-type\": \"interim\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"parse-cloudflare-logs-json-data\"\n  }, \"Parse Cloudflare Logs JSON data\"), mdx(\"h2\", {\n    \"id\": \"overview\"\n  }, \"Overview\"), mdx(\"p\", null, \"After downloading your Cloudflare Logs data, you can use different tools to parse and analyze your logs.\"), mdx(\"p\", null, \"In this tutorial, you will learn how to parse your JSON log data using \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"jq\"), \".  To get started with \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"jq\"), \", visit the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://stedolan.github.io/jq/\"\n  }, mdx(\"em\", {\n    parentName: \"a\"\n  }, \"jq\"), \" official site\"), \".\"), mdx(Aside, {\n    type: \"note\",\n    header: \"Note\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"jq\"), \" is a powerful command line for parsing JSON data and performing certain types of analysis. To perform more detailed analysis, consider a full-fledged data analysis system, such as \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Kibana\"), \".\")), mdx(\"h2\", {\n    \"id\": \"aggregating-fields\"\n  }, \"Aggregating fields\"), mdx(\"p\", null, \"To aggregate a field appearing in the log, such as by IP address, URI, or referrer, you can use several \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"jq\"), \" commands. This is useful to identify any patterns in traffic; for example, to identify your most popular pages or to block an attack.\"), mdx(\"p\", null, \"The following examples match on a field name and provide a count of each field instance, sorted in ascending order by count.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq -r .ClientRequestURI logs.json | sort -n | uniq -c | sort -n | tail\\n2 /nginx-logo.png\\n2 /poweredby.png\\n2 /testagain\\n3 /favicon.ico\\n3 /testing\\n3 /testing123\\n6 /test\\n7 /testing1234\\n10 /cdn-cgi/nexp/dok3v=1613a3a185/cloudflare/rocket.js\\n54 /\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq -r .ClientRequestUserAgent logs.json | sort -n | uniq -c | sort -n | tail\\n1 python-requests/2.9.1\\n2 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.56 Safari/537.17\\n4 Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36\\n5 curl/7.47.2-DEV\\n36 Mozilla/5.0 (X11; Linux x86_64; rv:44.0) Gecko/20100101 Firefox/44.0\\n51 curl/7.46.0-DEV\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq -r .ClientRequestReferer logs.json | sort -n | uniq -c | sort -n | tail\\n2 http://example.com/testagain\\n3 http://example.com/testing\\n5 http://example.com/\\n5 http://example.com/testing123\\n7 http://example.com/testing1234\\n77 null\\n\")), mdx(\"h2\", {\n    \"id\": \"filtering-fields\"\n  }, \"Filtering fields\"), mdx(\"p\", null, \"Another common use case involves filtering data for a specific field value and then aggregating after that. This helps answer questions like \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Which URLs saw the most 502 errors?\"), \" For example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq 'select(.OriginResponseStatus == 502) | .ClientRequestURI' logs.json | sort -n | uniq -c | sort -n | tail\\n1 \\\"/favicon.ico\\\"\\n1 \\\"/testing\\\"\\n3 \\\"/testing123\\\"\\n6 \\\"/test\\\"\\n6 \\\"/testing1234\\\"\\n18 \\\"/\\\"\\n\")), mdx(\"p\", null, \"To find out the top IP addresses blocked by the Cloudflare WAF, use the following query:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq -r 'select(.WAFAction == \\\"drop\\\") | .ClientIP' logs.json | sort -n | uniq -c | sort -n\\n1 127.0.0.1\\n\")), mdx(\"h2\", {\n    \"id\": \"showing-cached-requests\"\n  }, \"Showing cached requests\"), mdx(\"p\", null, \"To retrieve your cache ratios, try the following query:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq -r '.CacheCacheStatus' logs.json | sort -n | uniq -c | sort -n\\n3 hit\\n3 null\\n3 stale\\n4 expired\\n6 miss\\n81 unknown\\n\")), mdx(\"h2\", {\n    \"id\": \"showing-tls-versions\"\n  }, \"Showing TLS versions\"), mdx(\"p\", null, \"To find out which TLS versions your visitors are using \", \"\\u2014\", \" for example, to decide if you can disable TLS versions that are older than 1.2 \", \"\\u2014\", \" use the following query:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ jq -r '.ClientSSLProtocol' logs.json | sort -n | uniq -c | sort -n\\n42 none\\n58 TLSv1.2\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"order\": 85,\n  \"pcx-content-type\": \"interim\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\nconst Aside = makeShortcode(\"Aside\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1 {...{\n      \"id\": \"parse-cloudflare-logs-json-data\"\n    }}>{`Parse Cloudflare Logs JSON data`}</h1>\n    <h2 {...{\n      \"id\": \"overview\"\n    }}>{`Overview`}</h2>\n    <p>{`After downloading your Cloudflare Logs data, you can use different tools to parse and analyze your logs.`}</p>\n    <p>{`In this tutorial, you will learn how to parse your JSON log data using `}<em parentName=\"p\">{`jq`}</em>{`.  To get started with `}<em parentName=\"p\">{`jq`}</em>{`, visit the `}<a parentName=\"p\" {...{\n        \"href\": \"https://stedolan.github.io/jq/\"\n      }}><em parentName=\"a\">{`jq`}</em>{` official site`}</a>{`.`}</p>\n    <Aside type=\"note\" header=\"Note\" mdxType=\"Aside\">\n      <p><em parentName=\"p\">{`jq`}</em>{` is a powerful command line for parsing JSON data and performing certain types of analysis. To perform more detailed analysis, consider a full-fledged data analysis system, such as `}<em parentName=\"p\">{`Kibana`}</em>{`.`}</p>\n    </Aside>\n    <h2 {...{\n      \"id\": \"aggregating-fields\"\n    }}>{`Aggregating fields`}</h2>\n    <p>{`To aggregate a field appearing in the log, such as by IP address, URI, or referrer, you can use several `}<em parentName=\"p\">{`jq`}</em>{` commands. This is useful to identify any patterns in traffic; for example, to identify your most popular pages or to block an attack.`}</p>\n    <p>{`The following examples match on a field name and provide a count of each field instance, sorted in ascending order by count.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq -r .ClientRequestURI logs.json | sort -n | uniq -c | sort -n | tail\n2 /nginx-logo.png\n2 /poweredby.png\n2 /testagain\n3 /favicon.ico\n3 /testing\n3 /testing123\n6 /test\n7 /testing1234\n10 /cdn-cgi/nexp/dok3v=1613a3a185/cloudflare/rocket.js\n54 /\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq -r .ClientRequestUserAgent logs.json | sort -n | uniq -c | sort -n | tail\n1 python-requests/2.9.1\n2 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.56 Safari/537.17\n4 Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36\n5 curl/7.47.2-DEV\n36 Mozilla/5.0 (X11; Linux x86_64; rv:44.0) Gecko/20100101 Firefox/44.0\n51 curl/7.46.0-DEV\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq -r .ClientRequestReferer logs.json | sort -n | uniq -c | sort -n | tail\n2 http://example.com/testagain\n3 http://example.com/testing\n5 http://example.com/\n5 http://example.com/testing123\n7 http://example.com/testing1234\n77 null\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"filtering-fields\"\n    }}>{`Filtering fields`}</h2>\n    <p>{`Another common use case involves filtering data for a specific field value and then aggregating after that. This helps answer questions like `}<em parentName=\"p\">{`Which URLs saw the most 502 errors?`}</em>{` For example:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq 'select(.OriginResponseStatus == 502) | .ClientRequestURI' logs.json | sort -n | uniq -c | sort -n | tail\n1 \"/favicon.ico\"\n1 \"/testing\"\n3 \"/testing123\"\n6 \"/test\"\n6 \"/testing1234\"\n18 \"/\"\n`}</code></pre>\n    <p>{`To find out the top IP addresses blocked by the Cloudflare WAF, use the following query:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq -r 'select(.WAFAction == \"drop\") | .ClientIP' logs.json | sort -n | uniq -c | sort -n\n1 127.0.0.1\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"showing-cached-requests\"\n    }}>{`Showing cached requests`}</h2>\n    <p>{`To retrieve your cache ratios, try the following query:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq -r '.CacheCacheStatus' logs.json | sort -n | uniq -c | sort -n\n3 hit\n3 null\n3 stale\n4 expired\n6 miss\n81 unknown\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"showing-tls-versions\"\n    }}>{`Showing TLS versions`}</h2>\n    <p>{`To find out which TLS versions your visitors are using `}{`—`}{` for example, to decide if you can disable TLS versions that are older than 1.2 `}{`—`}{` use the following query:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ jq -r '.ClientSSLProtocol' logs.json | sort -n | uniq -c | sort -n\n42 none\n58 TLSv1.2\n`}</code></pre>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}