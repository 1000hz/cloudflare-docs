{"componentChunkName":"component---src-components-mdx-custom-renderer-js","path":"/custom-rules/rate-limiting/request-rate","result":{"data":{"mdx":{"id":"57e6d96e-605b-530a-abea-ef2fe944a146","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"pcx-content-type\": \"concept\",\n  \"order\": 11,\n  \"type\": \"overview\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar Example = makeShortcode(\"Example\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"determining-the-request-rate\"\n  }, \"Determining the request rate\"), mdx(Aside, {\n    type: \"warning\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"This feature is only available for selected customers on an Enterprise plan.\")), mdx(\"p\", null, \"Cloudflare keeps separate request counters for Rate Limiting rules for each value combination of the rule characteristics.\"), mdx(\"p\", null, \"For example, consider a rule configured with the following characteristics:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"IP address\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"HTTP header \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"x-api-key\"))), mdx(\"p\", null, \"In this case, two incoming requests with the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"same\"), \" value for the HTTP header \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"X-API-Key\"), \" with \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"different\"), \" IP addresses are counted separately, since the value combination is different. Additionally, counters are not shared across data centers.\"), mdx(Aside, {\n    type: \"warning\",\n    header: \"Important\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"The Cloudflare \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"data center ID\"), \" is a mandatory characteristic of every Rate Limiting rule. This characteristic does not appear in the rule configuration in the dashboard, but you must include it when \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/custom-rules/rate-limiting/create-api\"\n  }, \"creating Rate Limiting rules via API\"), \".\")), mdx(\"h2\", {\n    \"id\": \"example\"\n  }, \"Example\"), mdx(\"p\", null, \"Consider the following configuration for a Rate Limiting rule:\"), mdx(Example, {\n    mdxType: \"Example\"\n  }, mdx(\"p\", null, \"Expression:\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri.path eq \\\"/form\\\" and any(http.request.headers[\\\"content-type\\\"][*] eq \\\"application/x-www-form-urlencoded\\\")\")), mdx(\"p\", null, \"Action: \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Block\")), mdx(\"p\", null, \"Characteristics:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Data center ID\"), \" (included by default when creating the rule in the dashboard)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"IP Address\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"HTTP Header\"), \" > \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"x-api-key\"))), mdx(\"p\", null, \"Period: \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"10 seconds\")), mdx(\"p\", null, \"Requests per period: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1\")), mdx(\"p\", null, \"Mitigation timeout: \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"10 minutes\"))), mdx(\"p\", null, \"The following diagram shows how Cloudflare handles four incoming requests in the context of the above Rate Limiting rule.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"779px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4ea4ed122b51dd8f2a2bbb9e95ef70a6/96e92/rate-limiting-example.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"43.641618497109825%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Rate Limiting rule example diagram\",\n    \"title\": \"Rate Limiting rule example diagram\",\n    \"src\": \"/static/4ea4ed122b51dd8f2a2bbb9e95ef70a6/96e92/rate-limiting-example.png\",\n    \"srcSet\": [\"/static/4ea4ed122b51dd8f2a2bbb9e95ef70a6/8f77f/rate-limiting-example.png 346w\", \"/static/4ea4ed122b51dd8f2a2bbb9e95ef70a6/e185b/rate-limiting-example.png 691w\", \"/static/4ea4ed122b51dd8f2a2bbb9e95ef70a6/96e92/rate-limiting-example.png 779w\"],\n    \"sizes\": \"(max-width: 779px) 100vw, 779px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Since request 1 matches the rule expression, the Rate Limiting rule is evaluated. Cloudflare defines a request counter for the values of the characteristics in the context of the Rate Limiting rule and sets the counter to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1\"), \". Since the counter value is within the established limits in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Requests per period\"), \", the request is allowed.\"), mdx(\"p\", null, \"Request 2 matches the rule expression and therefore Cloudflare evaluates the Rate Limiting rule. The values of the characteristics do not match any existing counter (the value of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"X-API-Key\"), \" header is different). Therefore, Cloudflare defines a separate counter in the context of this rule and sets it to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1\"), \". The counter value is within the request limit established in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Requests per period\"), \", and so this request is allowed.\"), mdx(\"p\", null, \"Request 3 matches the rule expression and the same values for rule characteristics. Therefore, Cloudflare increases the value of the existing counter, setting it to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"2\"), \". The counter value is now above the limit defined in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Requests per period\"), \", and so request 2 gets blocked.\"), mdx(\"p\", null, \"Request 4 does not match the rule expression, since the value for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Content-Type\"), \" header does not match the value in the expression. Therefore, Cloudflare does not create a new rule counter for this request. Request 4 is not evaluated in the context of this Rate Limiting rule and is passed on to subsequent rules in the request evaluation workflow.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"","type":"overview","updated":null}}},"pageContext":{"id":"57e6d96e-605b-530a-abea-ef2fe944a146","fields":{"slug":"/custom-rules/rate-limiting/request-rate"},"frontmatter":{"pcx_content_type":"concept","title":"","type":"overview","order":11,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Determining the request rate","depth":1}],"tableOfContents":{"items":[{"url":"#determining-the-request-rate","title":"Determining the request rate","items":[{"url":"#example","title":"Example"}]}]},"parent":{"modifiedTime":"2022-01-25","relativePath":"custom-rules/rate-limiting/request-rate.md"}}},"staticQueryHashes":["2814688963","32046230","338033027","598566803","811020565"]}