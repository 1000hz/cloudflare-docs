{"expireTime":9007200897367345000,"key":"gatsby-plugin-mdx-entire-payload-dffada037f6d5e91b8fc99d470a1f5ab-","val":{"mdast":{"type":"root","children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"TLS","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":6,"offset":6},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":6,"offset":6},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This description of TLS is pulled from ","position":{"start":{"line":4,"column":1,"offset":8},"end":{"line":4,"column":40,"offset":47},"indent":[]}},{"type":"link","title":null,"url":"https://twitter.com/grittygrease?lang=en","children":[{"type":"text","value":"Nick's","position":{"start":{"line":4,"column":41,"offset":48},"end":{"line":4,"column":47,"offset":54},"indent":[]}}],"position":{"start":{"line":4,"column":40,"offset":47},"end":{"line":4,"column":90,"offset":97},"indent":[]}},{"type":"text","value":" blog post, ","position":{"start":{"line":4,"column":90,"offset":97},"end":{"line":4,"column":102,"offset":109},"indent":[]}},{"type":"link","title":null,"url":"https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/","children":[{"type":"text","value":"Keyless SSL: The Nitty Gritty Technical Details","position":{"start":{"line":4,"column":103,"offset":110},"end":{"line":4,"column":150,"offset":157},"indent":[]}}],"position":{"start":{"line":4,"column":102,"offset":109},"end":{"line":4,"column":228,"offset":235},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":4,"column":228,"offset":235},"end":{"line":4,"column":229,"offset":236},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":8},"end":{"line":4,"column":229,"offset":236},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Transport Layer Security (TLS) is the workhorse of web security. It lets websites prove their identity to web browsers, and protects all information exchanged from prying eyes using encryption. The TLS protocol has been around for years, but it’s still mysterious to even hardcore tech enthusiasts. Understanding the fundamentals of TLS is the key to understanding Keyless SSL.","position":{"start":{"line":6,"column":1,"offset":238},"end":{"line":6,"column":378,"offset":615},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":238},"end":{"line":6,"column":378,"offset":615},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"TLS has two main goals: confidentiality and authentication. Both are critically important to securely communicating on the Internet.","position":{"start":{"line":8,"column":1,"offset":617},"end":{"line":8,"column":133,"offset":749},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":617},"end":{"line":8,"column":133,"offset":749},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Communication is considered confidential when two parties are confident that nobody else can understand their conversation. Confidentiality can be achieved using symmetric encryption: use a key known only to the two parties involved to encrypt messages before sending them. In TLS, this symmetric encryption is typically done using a strong block cipher like ","position":{"start":{"line":10,"column":1,"offset":751},"end":{"line":10,"column":360,"offset":1110},"indent":[]}},{"type":"link","title":null,"url":"http://en.wikipedia.org/wiki/Advanced_Encryption_Standard","children":[{"type":"text","value":"AES","position":{"start":{"line":10,"column":361,"offset":1111},"end":{"line":10,"column":364,"offset":1114},"indent":[]}}],"position":{"start":{"line":10,"column":360,"offset":1110},"end":{"line":10,"column":424,"offset":1174},"indent":[]}},{"type":"text","value":". Older browsers and platforms might use a cipher like ","position":{"start":{"line":10,"column":424,"offset":1174},"end":{"line":10,"column":479,"offset":1229},"indent":[]}},{"type":"link","title":null,"url":"http://en.wikipedia.org/wiki/Triple_DES","children":[{"type":"text","value":"Triple DES","position":{"start":{"line":10,"column":480,"offset":1230},"end":{"line":10,"column":490,"offset":1240},"indent":[]}}],"position":{"start":{"line":10,"column":479,"offset":1229},"end":{"line":10,"column":532,"offset":1282},"indent":[]}},{"type":"text","value":" or the stream cipher ","position":{"start":{"line":10,"column":532,"offset":1282},"end":{"line":10,"column":554,"offset":1304},"indent":[]}},{"type":"link","title":null,"url":"http://en.wikipedia.org/wiki/RC4","children":[{"type":"text","value":"RC4","position":{"start":{"line":10,"column":555,"offset":1305},"end":{"line":10,"column":558,"offset":1308},"indent":[]}}],"position":{"start":{"line":10,"column":554,"offset":1304},"end":{"line":10,"column":593,"offset":1343},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":10,"column":593,"offset":1343},"end":{"line":10,"column":595,"offset":1345},"indent":[]}},{"type":"link","title":null,"url":"http://blog.cloudflare.com/killing-rc4-the-long-goodbye/","children":[{"type":"text","value":"which is now considered insecure","position":{"start":{"line":10,"column":596,"offset":1346},"end":{"line":10,"column":628,"offset":1378},"indent":[]}}],"position":{"start":{"line":10,"column":595,"offset":1345},"end":{"line":10,"column":687,"offset":1437},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":10,"column":687,"offset":1437},"end":{"line":10,"column":688,"offset":1438},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":751},"end":{"line":10,"column":688,"offset":1438},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The other crucial goal of TLS is authentication. Authentication is a way to ensure the person on the other end is who they say they are. This is accomplished with public keys. Websites use certificates and public key cryptography to prove their identity to web browsers. And browsers need two things to trust a certificate: proof that the other party is the owner of the certificate, and proof that the certificate is trusted.","position":{"start":{"line":12,"column":1,"offset":1440},"end":{"line":12,"column":427,"offset":1866},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":1440},"end":{"line":12,"column":427,"offset":1866},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A website certificate contains a public key, and if the website can prove that it controls the associated private key, that’s proof that they are the owner of the certificate. A browser considers a certificate trusted if the certificate was granted by a trusted certificate authority, and contains the site’s domain name.","position":{"start":{"line":14,"column":1,"offset":1868},"end":{"line":14,"column":322,"offset":2189},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1868},"end":{"line":14,"column":322,"offset":2189},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In the context of the web, confidentiality and authentication are achieved through the process of establishing a shared key and proving ownership of a certificate. TLS does this through a series of messages called a “handshake”.","position":{"start":{"line":16,"column":1,"offset":2191},"end":{"line":16,"column":229,"offset":2419},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":2191},"end":{"line":16,"column":229,"offset":2419},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"What’s in a handshake?","position":{"start":{"line":18,"column":4,"offset":2424},"end":{"line":18,"column":26,"offset":2446},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":2421},"end":{"line":18,"column":26,"offset":2446},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The TLS protocol evolved from the Secure Sockets Layer (SSL) protocol which was developed by Netscape in the mid-1990s. In 1999, the Internet Engineering Task Force (IETF) standardized a new protocol called TLS, which is an updated version of SSL. In fact, TLS is so similar to SSL that TLS 1.0 uses the SSL protocol version number 3.1. This may seem confusing at first, but makes sense since TLS is just a minor update to SSL 3.0. Subsequent versions of TLS have followed this pattern. Since TLS is an evolution of the SSL protocol, people still use the terms TLS and SSL somewhat interchangeably.","position":{"start":{"line":20,"column":1,"offset":2448},"end":{"line":20,"column":599,"offset":3046},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":2448},"end":{"line":20,"column":599,"offset":3046},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There are two main types of handshakes in TLS: one based on ","position":{"start":{"line":22,"column":1,"offset":3048},"end":{"line":22,"column":61,"offset":3108},"indent":[]}},{"type":"link","title":null,"url":"http://en.wikipedia.org/wiki/RSA_(cryptosystem)","children":[{"type":"text","value":"RSA","position":{"start":{"line":22,"column":62,"offset":3109},"end":{"line":22,"column":65,"offset":3112},"indent":[]}}],"position":{"start":{"line":22,"column":61,"offset":3108},"end":{"line":22,"column":115,"offset":3162},"indent":[]}},{"type":"text","value":", and one based on ","position":{"start":{"line":22,"column":115,"offset":3162},"end":{"line":22,"column":134,"offset":3181},"indent":[]}},{"type":"link","title":null,"url":"http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange","children":[{"type":"text","value":"Diffie-Hellman","position":{"start":{"line":22,"column":135,"offset":3182},"end":{"line":22,"column":149,"offset":3196},"indent":[]}}],"position":{"start":{"line":22,"column":134,"offset":3181},"end":{"line":22,"column":216,"offset":3263},"indent":[]}},{"type":"text","value":". RSA and Diffie-Hellman were the two algorithms which ushered in the era of modern cryptography, and brought cryptography to the masses. These two handshakes differ only in how the two goals of key establishment and authentication are achieved:","position":{"start":{"line":22,"column":216,"offset":3263},"end":{"line":22,"column":461,"offset":3508},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":3048},"end":{"line":22,"column":461,"offset":3508},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"../static/ssl-table.png","alt":"ssl-table","position":{"start":{"line":24,"column":1,"offset":3510},"end":{"line":24,"column":38,"offset":3547},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":3510},"end":{"line":24,"column":38,"offset":3547},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The RSA and DH handshakes both have their advantages and disadvantages. The RSA handshake only uses one public key algorithm operation, RSA. A DH handshake with an RSA certificate requires the same RSA operation, but with an additional DH operation. Given that the certificate is RSA, the RSA handshake is faster to compute. Public key algorithms like RSA and DH use a lot of CPU and are the slowest part of the TLS handshake. A laptop can only perform a couple hundred RSA encryptions a second versus around ten million per second of the symmetric cipher AES.","position":{"start":{"line":26,"column":1,"offset":3549},"end":{"line":26,"column":561,"offset":4109},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":3549},"end":{"line":26,"column":561,"offset":4109},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The DH handshake requires two algorithms to run, but the advantage it brings is that it allows key establishment to happen independently of the server’s private key. This gives the connection ","position":{"start":{"line":28,"column":1,"offset":4111},"end":{"line":28,"column":193,"offset":4303},"indent":[]}},{"type":"link","title":null,"url":"http://blog.cloudflare.com/staying-on-top-of-tls-attacks/","children":[{"type":"text","value":"forward secrecy","position":{"start":{"line":28,"column":194,"offset":4304},"end":{"line":28,"column":209,"offset":4319},"indent":[]}}],"position":{"start":{"line":28,"column":193,"offset":4303},"end":{"line":28,"column":269,"offset":4379},"indent":[]}},{"type":"text","value":", a useful property that protects conversations from being decrypted after the fact if the private key is somehow exposed. The DH version of the handshake also opens up the possibility of using non-RSA certificates that can improve performance, including ","position":{"start":{"line":28,"column":269,"offset":4379},"end":{"line":28,"column":524,"offset":4634},"indent":[]}},{"type":"link","title":null,"url":"http://blog.cloudflare.com/ecdsa-the-digital-signature-algorithm-of-a-better-internet/","children":[{"type":"text","value":"ECDSA keys","position":{"start":{"line":28,"column":525,"offset":4635},"end":{"line":28,"column":535,"offset":4645},"indent":[]}}],"position":{"start":{"line":28,"column":524,"offset":4634},"end":{"line":28,"column":624,"offset":4734},"indent":[]}},{"type":"text","value":". Elliptic curves provide the same security with less computational overhead. A DH handshake with and elliptic curve DSA certificate and elliptic curve Diffie-Hellman key agreement can be faster than a one-operation RSA handshake.","position":{"start":{"line":28,"column":624,"offset":4734},"end":{"line":28,"column":854,"offset":4964},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":4111},"end":{"line":28,"column":854,"offset":4964},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"TLS Glossary","position":{"start":{"line":30,"column":4,"offset":4969},"end":{"line":30,"column":16,"offset":4981},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":4966},"end":{"line":30,"column":16,"offset":4981},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"1. Session key","position":{"start":{"line":32,"column":5,"offset":4987},"end":{"line":32,"column":19,"offset":5001},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":4983},"end":{"line":32,"column":19,"offset":5001},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is the end result of a handshake. It’s a key for a symmetric cipher, and allows the client and server to encrypt messages to each other.","position":{"start":{"line":34,"column":1,"offset":5003},"end":{"line":34,"column":142,"offset":5144},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":5003},"end":{"line":34,"column":142,"offset":5144},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"2. Client random","position":{"start":{"line":36,"column":5,"offset":5150},"end":{"line":36,"column":21,"offset":5166},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":5146},"end":{"line":36,"column":21,"offset":5166},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is a sequence of 32 bytes created by the client. It’s unique for each connection, and is supposed to contain a four-byte timestamp followed by 28 random bytes. Recently, Google Chrome switched to using 32 bytes of random in order to prevent client fingerprinting. These random values are often called a ","position":{"start":{"line":38,"column":1,"offset":5168},"end":{"line":38,"column":309,"offset":5476},"indent":[]}},{"type":"link","title":null,"url":"http://en.wikipedia.org/wiki/Cryptographic_nonce","children":[{"type":"text","value":"nonce","position":{"start":{"line":38,"column":310,"offset":5477},"end":{"line":38,"column":315,"offset":5482},"indent":[]}}],"position":{"start":{"line":38,"column":309,"offset":5476},"end":{"line":38,"column":366,"offset":5533},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":38,"column":366,"offset":5533},"end":{"line":38,"column":367,"offset":5534},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":5168},"end":{"line":38,"column":367,"offset":5534},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"3. Server random","position":{"start":{"line":40,"column":5,"offset":5540},"end":{"line":40,"column":21,"offset":5556},"indent":[]}}],"position":{"start":{"line":40,"column":1,"offset":5536},"end":{"line":40,"column":21,"offset":5556},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A server random is the same as the client random except generated by the server.","position":{"start":{"line":42,"column":1,"offset":5558},"end":{"line":42,"column":81,"offset":5638},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":5558},"end":{"line":42,"column":81,"offset":5638},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"4. Pre-master secret","position":{"start":{"line":44,"column":5,"offset":5644},"end":{"line":44,"column":25,"offset":5664},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":5640},"end":{"line":44,"column":25,"offset":5664},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is a 48-byte blob of data. It can be combined with both the client random and the server random to create the session key using a “pseudorandom function” (PRF).","position":{"start":{"line":46,"column":1,"offset":5666},"end":{"line":46,"column":166,"offset":5831},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":5666},"end":{"line":46,"column":166,"offset":5831},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"5. Cipher suite","position":{"start":{"line":48,"column":5,"offset":5837},"end":{"line":48,"column":20,"offset":5852},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":5833},"end":{"line":48,"column":20,"offset":5852},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is a unique identifier for combining algorithms making up a TLS connection. It defines one algorithm for each of the following:","position":{"start":{"line":50,"column":1,"offset":5854},"end":{"line":50,"column":133,"offset":5986},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":5854},"end":{"line":50,"column":133,"offset":5986},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"key establishment (typically a Diffie-Hellman variant or RSA)","position":{"start":{"line":52,"column":5,"offset":5992},"end":{"line":52,"column":66,"offset":6053},"indent":[]}}],"position":{"start":{"line":52,"column":5,"offset":5992},"end":{"line":52,"column":66,"offset":6053},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":5988},"end":{"line":52,"column":66,"offset":6053},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"authentication (the certificate type)","position":{"start":{"line":53,"column":5,"offset":6058},"end":{"line":53,"column":42,"offset":6095},"indent":[]}}],"position":{"start":{"line":53,"column":5,"offset":6058},"end":{"line":53,"column":42,"offset":6095},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":6054},"end":{"line":53,"column":42,"offset":6095},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"confidentiality (a symmetric cipher)","position":{"start":{"line":54,"column":5,"offset":6100},"end":{"line":54,"column":41,"offset":6136},"indent":[]}}],"position":{"start":{"line":54,"column":5,"offset":6100},"end":{"line":54,"column":41,"offset":6136},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":6096},"end":{"line":54,"column":41,"offset":6136},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"integrity (a hash function)","position":{"start":{"line":55,"column":5,"offset":6141},"end":{"line":55,"column":32,"offset":6168},"indent":[]}}],"position":{"start":{"line":55,"column":5,"offset":6141},"end":{"line":55,"column":32,"offset":6168},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":6137},"end":{"line":55,"column":32,"offset":6168},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":5988},"end":{"line":55,"column":32,"offset":6168},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"For example “AES128-SHA” defines a session that uses","position":{"start":{"line":57,"column":1,"offset":6170},"end":{"line":57,"column":53,"offset":6222},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":6170},"end":{"line":57,"column":53,"offset":6222},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"RSA for key establishment (implied)","position":{"start":{"line":59,"column":5,"offset":6228},"end":{"line":59,"column":40,"offset":6263},"indent":[]}}],"position":{"start":{"line":59,"column":5,"offset":6228},"end":{"line":59,"column":40,"offset":6263},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":6224},"end":{"line":59,"column":40,"offset":6263},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"RSA for authentication (implied)","position":{"start":{"line":60,"column":5,"offset":6268},"end":{"line":60,"column":37,"offset":6300},"indent":[]}}],"position":{"start":{"line":60,"column":5,"offset":6268},"end":{"line":60,"column":37,"offset":6300},"indent":[]}}],"position":{"start":{"line":60,"column":1,"offset":6264},"end":{"line":60,"column":37,"offset":6300},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"128-bit Advanced Encryption Standard in Cipher Block Chaining (CBC) mode for confidentiality","position":{"start":{"line":61,"column":5,"offset":6305},"end":{"line":61,"column":97,"offset":6397},"indent":[]}}],"position":{"start":{"line":61,"column":5,"offset":6305},"end":{"line":61,"column":97,"offset":6397},"indent":[]}}],"position":{"start":{"line":61,"column":1,"offset":6301},"end":{"line":61,"column":97,"offset":6397},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"160-bit Secure Hashing Algorithm (SHA) for integrity","position":{"start":{"line":62,"column":5,"offset":6402},"end":{"line":62,"column":57,"offset":6454},"indent":[]}}],"position":{"start":{"line":62,"column":5,"offset":6402},"end":{"line":62,"column":57,"offset":6454},"indent":[]}}],"position":{"start":{"line":62,"column":1,"offset":6398},"end":{"line":62,"column":57,"offset":6454},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":6224},"end":{"line":62,"column":57,"offset":6454},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A more daunting, but valid cipher suite is “ECDHE-ECDSA-AES256-GCM-SHA384” which defines a session that uses:","position":{"start":{"line":64,"column":1,"offset":6456},"end":{"line":64,"column":110,"offset":6565},"indent":[]}}],"position":{"start":{"line":64,"column":1,"offset":6456},"end":{"line":64,"column":110,"offset":6565},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Elliptic Curve Diffie-Hellman Ephemeral (ECDHE) key exchange for key establishment","position":{"start":{"line":66,"column":5,"offset":6571},"end":{"line":66,"column":87,"offset":6653},"indent":[]}}],"position":{"start":{"line":66,"column":5,"offset":6571},"end":{"line":66,"column":87,"offset":6653},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":6567},"end":{"line":66,"column":87,"offset":6653},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Elliptic Curve Digital Signature Algorithms (ECDSA) for authentication","position":{"start":{"line":67,"column":5,"offset":6658},"end":{"line":67,"column":75,"offset":6728},"indent":[]}}],"position":{"start":{"line":67,"column":5,"offset":6658},"end":{"line":67,"column":75,"offset":6728},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":6654},"end":{"line":67,"column":75,"offset":6728},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"256-bit Advanced Encryption Standard in Galois/Counter mode (GCM) for confidentiality","position":{"start":{"line":68,"column":5,"offset":6733},"end":{"line":68,"column":90,"offset":6818},"indent":[]}}],"position":{"start":{"line":68,"column":5,"offset":6733},"end":{"line":68,"column":90,"offset":6818},"indent":[]}}],"position":{"start":{"line":68,"column":1,"offset":6729},"end":{"line":68,"column":90,"offset":6818},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"384-bit Secure Hashing Algorithm for integrity","position":{"start":{"line":69,"column":5,"offset":6823},"end":{"line":69,"column":51,"offset":6869},"indent":[]}}],"position":{"start":{"line":69,"column":5,"offset":6823},"end":{"line":69,"column":51,"offset":6869},"indent":[]}}],"position":{"start":{"line":69,"column":1,"offset":6819},"end":{"line":69,"column":51,"offset":6869},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":6567},"end":{"line":69,"column":51,"offset":6869},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"With these definitions in hand, let’s walk through an RSA handshake.","position":{"start":{"line":71,"column":1,"offset":6871},"end":{"line":71,"column":69,"offset":6939},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":6871},"end":{"line":71,"column":69,"offset":6939},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"RSA handshake","position":{"start":{"line":73,"column":4,"offset":6944},"end":{"line":73,"column":17,"offset":6957},"indent":[]}}],"position":{"start":{"line":73,"column":1,"offset":6941},"end":{"line":73,"column":17,"offset":6957},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Note that none of the messages in the handshake are encrypted with a session key; they are all sent in the clear.","position":{"start":{"line":75,"column":1,"offset":6959},"end":{"line":75,"column":114,"offset":7072},"indent":[]}}],"position":{"start":{"line":75,"column":1,"offset":6959},"end":{"line":75,"column":114,"offset":7072},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"../static/ssl_handshake_rsa.jpg","alt":"rsa-handshake","position":{"start":{"line":77,"column":1,"offset":7074},"end":{"line":77,"column":50,"offset":7123},"indent":[]}}],"position":{"start":{"line":77,"column":1,"offset":7074},"end":{"line":77,"column":50,"offset":7123},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 1: “Client Hello”","position":{"start":{"line":79,"column":5,"offset":7129},"end":{"line":79,"column":30,"offset":7154},"indent":[]}}],"position":{"start":{"line":79,"column":1,"offset":7125},"end":{"line":79,"column":30,"offset":7154},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The client hello contains the protocol version that the client wants to use, and some other information to get the handshake started including the client random and a list of cipher suites. Modern browsers also include the hostname they are looking for, called the Server Name Indication (SNI). SNI lets the web server host multiple domains on the same IP address.","position":{"start":{"line":81,"column":1,"offset":7156},"end":{"line":81,"column":365,"offset":7520},"indent":[]}}],"position":{"start":{"line":81,"column":1,"offset":7156},"end":{"line":81,"column":365,"offset":7520},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 2: “Server Hello”","position":{"start":{"line":83,"column":5,"offset":7526},"end":{"line":83,"column":30,"offset":7551},"indent":[]}}],"position":{"start":{"line":83,"column":1,"offset":7522},"end":{"line":83,"column":30,"offset":7551},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After receiving the client hello, the server picks the parameters for the handshake going forward. The choice of cipher suite determines what type of handshake is performed. The server “hello” message contains the server random, the server’s chosen cipher suite, and the server’s certificate. The certificate contains the server’s public key and domain name.","position":{"start":{"line":85,"column":1,"offset":7553},"end":{"line":85,"column":359,"offset":7911},"indent":[]}}],"position":{"start":{"line":85,"column":1,"offset":7553},"end":{"line":85,"column":359,"offset":7911},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 3: “Client Key Exchange”","position":{"start":{"line":87,"column":5,"offset":7917},"end":{"line":87,"column":37,"offset":7949},"indent":[]}}],"position":{"start":{"line":87,"column":1,"offset":7913},"end":{"line":87,"column":37,"offset":7949},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After validating that the certificate is trusted and belongs to the site they are trying to reach, the client creates a random pre-master secret. This secret is encrypted with the public key from the certificate, and sent to the server.","position":{"start":{"line":89,"column":1,"offset":7951},"end":{"line":89,"column":237,"offset":8187},"indent":[]}}],"position":{"start":{"line":89,"column":1,"offset":7951},"end":{"line":89,"column":237,"offset":8187},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Upon receiving this message, the server uses its private key to decrypt this pre-master secret. Now that both sides have the pre-master secret, and both client and server randoms, they can both derive the same session key. Then they exchange a short message to indicate that the next message they send will be encrypted.","position":{"start":{"line":91,"column":1,"offset":8189},"end":{"line":91,"column":321,"offset":8509},"indent":[]}}],"position":{"start":{"line":91,"column":1,"offset":8189},"end":{"line":91,"column":321,"offset":8509},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The handshake is officially complete when the client and server exchange “Finished” messages. The actual text is literally: “client finished” or “server finished” encrypted with the session key. Any subsequent communication between the two parties are encrypted with the session key.","position":{"start":{"line":93,"column":1,"offset":8511},"end":{"line":93,"column":284,"offset":8794},"indent":[]}}],"position":{"start":{"line":93,"column":1,"offset":8511},"end":{"line":93,"column":284,"offset":8794},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This handshake is elegant because it combines key exchange and authentication in one step. The logic is that if the server can correctly derive the session key, then they must have access to the private key, and, therefore, be the owner of the certificate.","position":{"start":{"line":95,"column":1,"offset":8796},"end":{"line":95,"column":257,"offset":9052},"indent":[]}}],"position":{"start":{"line":95,"column":1,"offset":8796},"end":{"line":95,"column":257,"offset":9052},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The downside of this handshake is that the messages secured by it are only as safe as the private key. Suppose a third party has recorded the handshake and the subsequent communication. If that party gets access to the private key in the future, they will be able to decrypt the premaster secret and derive the session key. With that they can decrypt the entire message. This is true even if the certificate is expired or revoked. This leads us to another form of handshake that can provide confidentiality even if the private key is compromised.","position":{"start":{"line":97,"column":1,"offset":9054},"end":{"line":97,"column":547,"offset":9600},"indent":[]}}],"position":{"start":{"line":97,"column":1,"offset":9054},"end":{"line":97,"column":547,"offset":9600},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Ephemeral Diffie-Hellman handshake","position":{"start":{"line":99,"column":4,"offset":9605},"end":{"line":99,"column":38,"offset":9639},"indent":[]}}],"position":{"start":{"line":99,"column":1,"offset":9602},"end":{"line":99,"column":38,"offset":9639},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ephemeral Diffie-Hellman handshake is an alternative form of the TLS handshake. It uses two different mechanisms: one for establishing a shared pre-master secret, and one for authenticating the server. The key feature that this relies on is the Diffie-Hellman key agreement algorithm.","position":{"start":{"line":101,"column":1,"offset":9641},"end":{"line":101,"column":289,"offset":9929},"indent":[]}}],"position":{"start":{"line":101,"column":1,"offset":9641},"end":{"line":101,"column":289,"offset":9929},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In Diffie-Hellman, two parties with different secrets exchange messages to obtain a shared secret. This handshake relies on the simple fact that exponents are commutative. Specifically that taking a number to the power of a, and the result to the power of b, is the same as taking the same number to the power of b, and the result to the power of a.","position":{"start":{"line":103,"column":1,"offset":9931},"end":{"line":103,"column":350,"offset":10280},"indent":[]}}],"position":{"start":{"line":103,"column":1,"offset":9931},"end":{"line":103,"column":350,"offset":10280},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The algorithm works like this:","position":{"start":{"line":105,"column":1,"offset":10282},"end":{"line":105,"column":31,"offset":10312},"indent":[]}}],"position":{"start":{"line":105,"column":1,"offset":10282},"end":{"line":105,"column":31,"offset":10312},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"person a has secret a, sends g","position":{"start":{"line":107,"column":5,"offset":10318},"end":{"line":107,"column":35,"offset":10348},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":107,"column":35,"offset":10348},"end":{"line":107,"column":40,"offset":10353},"indent":[]}},{"type":"text","value":"a","position":{"start":{"line":107,"column":40,"offset":10353},"end":{"line":107,"column":41,"offset":10354},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":107,"column":41,"offset":10354},"end":{"line":107,"column":47,"offset":10360},"indent":[]}},{"type":"text","value":" to person b","position":{"start":{"line":107,"column":47,"offset":10360},"end":{"line":107,"column":59,"offset":10372},"indent":[]}}],"position":{"start":{"line":107,"column":5,"offset":10318},"end":{"line":107,"column":59,"offset":10372},"indent":[]}}],"position":{"start":{"line":107,"column":1,"offset":10314},"end":{"line":107,"column":59,"offset":10372},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"person b has secret b, sends g","position":{"start":{"line":108,"column":5,"offset":10377},"end":{"line":108,"column":35,"offset":10407},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":108,"column":35,"offset":10407},"end":{"line":108,"column":40,"offset":10412},"indent":[]}},{"type":"text","value":"b","position":{"start":{"line":108,"column":40,"offset":10412},"end":{"line":108,"column":41,"offset":10413},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":108,"column":41,"offset":10413},"end":{"line":108,"column":47,"offset":10419},"indent":[]}},{"type":"text","value":" to person a","position":{"start":{"line":108,"column":47,"offset":10419},"end":{"line":108,"column":59,"offset":10431},"indent":[]}}],"position":{"start":{"line":108,"column":5,"offset":10377},"end":{"line":108,"column":59,"offset":10431},"indent":[]}}],"position":{"start":{"line":108,"column":1,"offset":10373},"end":{"line":108,"column":59,"offset":10431},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"person a computes (g","position":{"start":{"line":109,"column":5,"offset":10436},"end":{"line":109,"column":25,"offset":10456},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":109,"column":25,"offset":10456},"end":{"line":109,"column":30,"offset":10461},"indent":[]}},{"type":"text","value":"b","position":{"start":{"line":109,"column":30,"offset":10461},"end":{"line":109,"column":31,"offset":10462},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":109,"column":31,"offset":10462},"end":{"line":109,"column":37,"offset":10468},"indent":[]}},{"type":"text","value":")","position":{"start":{"line":109,"column":37,"offset":10468},"end":{"line":109,"column":38,"offset":10469},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":109,"column":38,"offset":10469},"end":{"line":109,"column":43,"offset":10474},"indent":[]}},{"type":"text","value":"a","position":{"start":{"line":109,"column":43,"offset":10474},"end":{"line":109,"column":44,"offset":10475},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":109,"column":44,"offset":10475},"end":{"line":109,"column":50,"offset":10481},"indent":[]}}],"position":{"start":{"line":109,"column":5,"offset":10436},"end":{"line":109,"column":50,"offset":10481},"indent":[]}}],"position":{"start":{"line":109,"column":1,"offset":10432},"end":{"line":109,"column":50,"offset":10481},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"person b computes (g","position":{"start":{"line":110,"column":5,"offset":10486},"end":{"line":110,"column":25,"offset":10506},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":110,"column":25,"offset":10506},"end":{"line":110,"column":30,"offset":10511},"indent":[]}},{"type":"text","value":"a","position":{"start":{"line":110,"column":30,"offset":10511},"end":{"line":110,"column":31,"offset":10512},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":110,"column":31,"offset":10512},"end":{"line":110,"column":37,"offset":10518},"indent":[]}},{"type":"text","value":")","position":{"start":{"line":110,"column":37,"offset":10518},"end":{"line":110,"column":38,"offset":10519},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":110,"column":38,"offset":10519},"end":{"line":110,"column":43,"offset":10524},"indent":[]}},{"type":"text","value":"b","position":{"start":{"line":110,"column":43,"offset":10524},"end":{"line":110,"column":44,"offset":10525},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":110,"column":44,"offset":10525},"end":{"line":110,"column":50,"offset":10531},"indent":[]}}],"position":{"start":{"line":110,"column":5,"offset":10486},"end":{"line":110,"column":50,"offset":10531},"indent":[]}}],"position":{"start":{"line":110,"column":1,"offset":10482},"end":{"line":110,"column":50,"offset":10531},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Both person a and b end up with g","position":{"start":{"line":111,"column":5,"offset":10536},"end":{"line":111,"column":38,"offset":10569},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":111,"column":38,"offset":10569},"end":{"line":111,"column":43,"offset":10574},"indent":[]}},{"type":"text","value":"ab","position":{"start":{"line":111,"column":43,"offset":10574},"end":{"line":111,"column":45,"offset":10576},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":111,"column":45,"offset":10576},"end":{"line":111,"column":51,"offset":10582},"indent":[]}},{"type":"text","value":", which is their shared secret","position":{"start":{"line":111,"column":51,"offset":10582},"end":{"line":111,"column":81,"offset":10612},"indent":[]}}],"position":{"start":{"line":111,"column":5,"offset":10536},"end":{"line":111,"column":81,"offset":10612},"indent":[]}}],"position":{"start":{"line":111,"column":1,"offset":10532},"end":{"line":111,"column":81,"offset":10612},"indent":[]}}],"position":{"start":{"line":107,"column":1,"offset":10314},"end":{"line":111,"column":81,"offset":10612},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This doesn't work well with regular numbers because g","position":{"start":{"line":113,"column":1,"offset":10614},"end":{"line":113,"column":54,"offset":10667},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":113,"column":54,"offset":10667},"end":{"line":113,"column":59,"offset":10672},"indent":[]}},{"type":"text","value":"ab","position":{"start":{"line":113,"column":59,"offset":10672},"end":{"line":113,"column":61,"offset":10674},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":113,"column":61,"offset":10674},"end":{"line":113,"column":67,"offset":10680},"indent":[]}},{"type":"text","value":" can get really large, and there are efficient ways to take the nth root of a number. However, we can change the problem space and make it work. This is done by restricting the computation to numbers of a fixed size by always dividing the result of a computation by big prime number and taking the remainder. This is called modular arithmetic. Taking an nth root in modular arithmetic is called the discrete logarithm problem and is considered a hard problem.","position":{"start":{"line":113,"column":67,"offset":10680},"end":{"line":113,"column":526,"offset":11139},"indent":[]}}],"position":{"start":{"line":113,"column":1,"offset":10614},"end":{"line":113,"column":526,"offset":11139},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now let’s go through a Diffie-Hellman handshake:","position":{"start":{"line":115,"column":1,"offset":11141},"end":{"line":115,"column":49,"offset":11189},"indent":[]}}],"position":{"start":{"line":115,"column":1,"offset":11141},"end":{"line":115,"column":49,"offset":11189},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"../static/ssl_handshake_diffie_hellman.jpg","alt":"dh-handshake","position":{"start":{"line":117,"column":1,"offset":11191},"end":{"line":117,"column":60,"offset":11250},"indent":[]}}],"position":{"start":{"line":117,"column":1,"offset":11191},"end":{"line":117,"column":60,"offset":11250},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 1: “Client Hello”","position":{"start":{"line":119,"column":5,"offset":11256},"end":{"line":119,"column":30,"offset":11281},"indent":[]}}],"position":{"start":{"line":119,"column":1,"offset":11252},"end":{"line":119,"column":30,"offset":11281},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Just like in the RSA case, the client hello contains the protocol version, the client random, a list of cipher suites, and, optionally, the SNI extension. If the client speaks ECDHE, they include the list of curves they support. If this is omitted, or there is a mismatch, it can be tricky to debug.","position":{"start":{"line":121,"column":1,"offset":11283},"end":{"line":121,"column":300,"offset":11582},"indent":[]}}],"position":{"start":{"line":121,"column":1,"offset":11283},"end":{"line":121,"column":300,"offset":11582},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 2: “Server Hello”","position":{"start":{"line":123,"column":5,"offset":11588},"end":{"line":123,"column":30,"offset":11613},"indent":[]}}],"position":{"start":{"line":123,"column":1,"offset":11584},"end":{"line":123,"column":30,"offset":11613},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After receiving the client hello, the server picks the parameters for the handshake going forward, including the curve for ECDHE. The server “hello” message contains the server random, the server’s chosen cipher suite, and the server’s certificate.","position":{"start":{"line":125,"column":1,"offset":11615},"end":{"line":125,"column":249,"offset":11863},"indent":[]}}],"position":{"start":{"line":125,"column":1,"offset":11615},"end":{"line":125,"column":249,"offset":11863},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The RSA and Diffie-Hellman handshakes start to differ at this point with a new message type.","position":{"start":{"line":127,"column":1,"offset":11865},"end":{"line":127,"column":93,"offset":11957},"indent":[]}}],"position":{"start":{"line":127,"column":1,"offset":11865},"end":{"line":127,"column":93,"offset":11957},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 3: “Server Key Exchange”","position":{"start":{"line":129,"column":5,"offset":11963},"end":{"line":129,"column":37,"offset":11995},"indent":[]}}],"position":{"start":{"line":129,"column":1,"offset":11959},"end":{"line":129,"column":37,"offset":11995},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In order to start the Diffie-Hellman key exchange, the server needs to pick some starting parameters and send them to the client---this corresponds to the ga we described above. The server also needs a way to prove that it has control of the private key, so the server computes a digital signature of all the messages up to this point. Both the Diffie-Hellman parameters and the signature are sent in this message.","position":{"start":{"line":131,"column":1,"offset":11997},"end":{"line":131,"column":415,"offset":12411},"indent":[]}}],"position":{"start":{"line":131,"column":1,"offset":11997},"end":{"line":131,"column":415,"offset":12411},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Message 4: “Client Key Exchange”","position":{"start":{"line":133,"column":5,"offset":12417},"end":{"line":133,"column":37,"offset":12449},"indent":[]}}],"position":{"start":{"line":133,"column":1,"offset":12413},"end":{"line":133,"column":37,"offset":12449},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After validating that the certificate is trusted, and belongs to the site they are trying to reach, the client validates the digital signature sent from the server. They also send the client half of the Diffie-Hellman handshake (corresponding to g","position":{"start":{"line":135,"column":1,"offset":12451},"end":{"line":135,"column":248,"offset":12698},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":135,"column":248,"offset":12698},"end":{"line":135,"column":253,"offset":12703},"indent":[]}},{"type":"text","value":"b","position":{"start":{"line":135,"column":253,"offset":12703},"end":{"line":135,"column":254,"offset":12704},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":135,"column":254,"offset":12704},"end":{"line":135,"column":260,"offset":12710},"indent":[]}},{"type":"text","value":" above).","position":{"start":{"line":135,"column":260,"offset":12710},"end":{"line":135,"column":268,"offset":12718},"indent":[]}}],"position":{"start":{"line":135,"column":1,"offset":12451},"end":{"line":135,"column":268,"offset":12718},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"At this point, both sides can compute the pre-master secret from the Diffie-Hellman parameters (corresponding to g","position":{"start":{"line":137,"column":1,"offset":12720},"end":{"line":137,"column":115,"offset":12834},"indent":[]}},{"type":"jsx","value":"<sup>","position":{"start":{"line":137,"column":115,"offset":12834},"end":{"line":137,"column":120,"offset":12839},"indent":[]}},{"type":"text","value":"ab","position":{"start":{"line":137,"column":120,"offset":12839},"end":{"line":137,"column":122,"offset":12841},"indent":[]}},{"type":"jsx","value":"</sup>","position":{"start":{"line":137,"column":122,"offset":12841},"end":{"line":137,"column":128,"offset":12847},"indent":[]}},{"type":"text","value":" above). With the pre-master secret and both client and server randoms, they can derive the same session key. They then exchange a short message to indicate that they the next message they send will be encrypted.","position":{"start":{"line":137,"column":128,"offset":12847},"end":{"line":137,"column":340,"offset":13059},"indent":[]}}],"position":{"start":{"line":137,"column":1,"offset":12720},"end":{"line":137,"column":340,"offset":13059},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Just like in the RSA handshake, this handshake is officially complete when the client and server exchange “Finished” messages. Any subsequent communication between the two parties are encrypted with the session key.","position":{"start":{"line":139,"column":1,"offset":13061},"end":{"line":139,"column":216,"offset":13276},"indent":[]}}],"position":{"start":{"line":139,"column":1,"offset":13061},"end":{"line":139,"column":216,"offset":13276},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"order\":73,\"pcx-content-type\":\"concept\"}","position":{"start":{"line":142,"column":1,"offset":13279},"end":{"line":142,"column":70,"offset":13348},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":142,"column":70,"offset":13348}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"order\": 73,\n  \"pcx-content-type\": \"concept\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"tls\"\n  }, \"TLS\"), mdx(\"p\", null, \"This description of TLS is pulled from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://twitter.com/grittygrease?lang=en\"\n  }, \"Nick's\"), \" blog post, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/\"\n  }, \"Keyless SSL: The Nitty Gritty Technical Details\"), \".\"), mdx(\"p\", null, \"Transport Layer Security (TLS) is the workhorse of web security. It lets websites prove their identity to web browsers, and protects all information exchanged from prying eyes using encryption. The TLS protocol has been around for years, but it\\u2019s still mysterious to even hardcore tech enthusiasts. Understanding the fundamentals of TLS is the key to understanding Keyless SSL.\"), mdx(\"p\", null, \"TLS has two main goals: confidentiality and authentication. Both are critically important to securely communicating on the Internet.\"), mdx(\"p\", null, \"Communication is considered confidential when two parties are confident that nobody else can understand their conversation. Confidentiality can be achieved using symmetric encryption: use a key known only to the two parties involved to encrypt messages before sending them. In TLS, this symmetric encryption is typically done using a strong block cipher like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://en.wikipedia.org/wiki/Advanced_Encryption_Standard\"\n  }, \"AES\"), \". Older browsers and platforms might use a cipher like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://en.wikipedia.org/wiki/Triple_DES\"\n  }, \"Triple DES\"), \" or the stream cipher \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://en.wikipedia.org/wiki/RC4\"\n  }, \"RC4\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://blog.cloudflare.com/killing-rc4-the-long-goodbye/\"\n  }, \"which is now considered insecure\"), \".\"), mdx(\"p\", null, \"The other crucial goal of TLS is authentication. Authentication is a way to ensure the person on the other end is who they say they are. This is accomplished with public keys. Websites use certificates and public key cryptography to prove their identity to web browsers. And browsers need two things to trust a certificate: proof that the other party is the owner of the certificate, and proof that the certificate is trusted.\"), mdx(\"p\", null, \"A website certificate contains a public key, and if the website can prove that it controls the associated private key, that\\u2019s proof that they are the owner of the certificate. A browser considers a certificate trusted if the certificate was granted by a trusted certificate authority, and contains the site\\u2019s domain name.\"), mdx(\"p\", null, \"In the context of the web, confidentiality and authentication are achieved through the process of establishing a shared key and proving ownership of a certificate. TLS does this through a series of messages called a \\u201Chandshake\\u201D.\"), mdx(\"h2\", {\n    \"id\": \"whats-in-a-handshake\"\n  }, \"What\\u2019s in a handshake?\"), mdx(\"p\", null, \"The TLS protocol evolved from the Secure Sockets Layer (SSL) protocol which was developed by Netscape in the mid-1990s. In 1999, the Internet Engineering Task Force (IETF) standardized a new protocol called TLS, which is an updated version of SSL. In fact, TLS is so similar to SSL that TLS 1.0 uses the SSL protocol version number 3.1. This may seem confusing at first, but makes sense since TLS is just a minor update to SSL 3.0. Subsequent versions of TLS have followed this pattern. Since TLS is an evolution of the SSL protocol, people still use the terms TLS and SSL somewhat interchangeably.\"), mdx(\"p\", null, \"There are two main types of handshakes in TLS: one based on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://en.wikipedia.org/wiki/RSA_(cryptosystem)\"\n  }, \"RSA\"), \", and one based on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange\"\n  }, \"Diffie-Hellman\"), \". RSA and Diffie-Hellman were the two algorithms which ushered in the era of modern cryptography, and brought cryptography to the masses. These two handshakes differ only in how the two goals of key establishment and authentication are achieved:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/bb8d84c901ed3895f977512d1b13a391/5a190/ssl-table.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"18.78612716763006%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQI1yWIy0rDQABF8x3iQnDpxl2FYvGnFHEjuPBV/AkXglaJDaQI5mGtySQmxBCHCW1iO5Mhk5lJVNQfMFA4XO45ihFKI5CPgRxH9aVJ1g/szrGzdeLsXPi9PuieuZtHz6t75squsXE47vXd7jnYbvupu7ZvKShjGZZpzrKFmNHvu1eiR4UWkisbagHWIzoMycDDNwCrAR690etJOnCmbb/1sELwghZk/pEXBfn7/fmSVV2VklGUxKzADWc1Lz8Fa2l4KatyhmA+RTVnjWBKAmHyDuM4RijlQgDPd4HXrj56mLw4S13SfsO0VHWo3muW/QR8/x+ODLaV3aKnbAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"ssl-table\",\n    \"title\": \"ssl-table\",\n    \"src\": \"/static/bb8d84c901ed3895f977512d1b13a391/5a190/ssl-table.png\",\n    \"srcSet\": [\"/static/bb8d84c901ed3895f977512d1b13a391/8f77f/ssl-table.png 346w\", \"/static/bb8d84c901ed3895f977512d1b13a391/e185b/ssl-table.png 691w\", \"/static/bb8d84c901ed3895f977512d1b13a391/5a190/ssl-table.png 800w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The RSA and DH handshakes both have their advantages and disadvantages. The RSA handshake only uses one public key algorithm operation, RSA. A DH handshake with an RSA certificate requires the same RSA operation, but with an additional DH operation. Given that the certificate is RSA, the RSA handshake is faster to compute. Public key algorithms like RSA and DH use a lot of CPU and are the slowest part of the TLS handshake. A laptop can only perform a couple hundred RSA encryptions a second versus around ten million per second of the symmetric cipher AES.\"), mdx(\"p\", null, \"The DH handshake requires two algorithms to run, but the advantage it brings is that it allows key establishment to happen independently of the server\\u2019s private key. This gives the connection \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://blog.cloudflare.com/staying-on-top-of-tls-attacks/\"\n  }, \"forward secrecy\"), \", a useful property that protects conversations from being decrypted after the fact if the private key is somehow exposed. The DH version of the handshake also opens up the possibility of using non-RSA certificates that can improve performance, including \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://blog.cloudflare.com/ecdsa-the-digital-signature-algorithm-of-a-better-internet/\"\n  }, \"ECDSA keys\"), \". Elliptic curves provide the same security with less computational overhead. A DH handshake with and elliptic curve DSA certificate and elliptic curve Diffie-Hellman key agreement can be faster than a one-operation RSA handshake.\"), mdx(\"h2\", {\n    \"id\": \"tls-glossary\"\n  }, \"TLS Glossary\"), mdx(\"h3\", {\n    \"id\": \"1-session-key\"\n  }, \"1. Session key\"), mdx(\"p\", null, \"This is the end result of a handshake. It\\u2019s a key for a symmetric cipher, and allows the client and server to encrypt messages to each other.\"), mdx(\"h3\", {\n    \"id\": \"2-client-random\"\n  }, \"2. Client random\"), mdx(\"p\", null, \"This is a sequence of 32 bytes created by the client. It\\u2019s unique for each connection, and is supposed to contain a four-byte timestamp followed by 28 random bytes. Recently, Google Chrome switched to using 32 bytes of random in order to prevent client fingerprinting. These random values are often called a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://en.wikipedia.org/wiki/Cryptographic_nonce\"\n  }, \"nonce\"), \".\"), mdx(\"h3\", {\n    \"id\": \"3-server-random\"\n  }, \"3. Server random\"), mdx(\"p\", null, \"A server random is the same as the client random except generated by the server.\"), mdx(\"h3\", {\n    \"id\": \"4-pre-master-secret\"\n  }, \"4. Pre-master secret\"), mdx(\"p\", null, \"This is a 48-byte blob of data. It can be combined with both the client random and the server random to create the session key using a \\u201Cpseudorandom function\\u201D (PRF).\"), mdx(\"h3\", {\n    \"id\": \"5-cipher-suite\"\n  }, \"5. Cipher suite\"), mdx(\"p\", null, \"This is a unique identifier for combining algorithms making up a TLS connection. It defines one algorithm for each of the following:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"key establishment (typically a Diffie-Hellman variant or RSA)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"authentication (the certificate type)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"confidentiality (a symmetric cipher)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"integrity (a hash function)\")), mdx(\"p\", null, \"For example \\u201CAES128-SHA\\u201D defines a session that uses\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"RSA for key establishment (implied)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"RSA for authentication (implied)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"128-bit Advanced Encryption Standard in Cipher Block Chaining (CBC) mode for confidentiality\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"160-bit Secure Hashing Algorithm (SHA) for integrity\")), mdx(\"p\", null, \"A more daunting, but valid cipher suite is \\u201CECDHE-ECDSA-AES256-GCM-SHA384\\u201D which defines a session that uses:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Elliptic Curve Diffie-Hellman Ephemeral (ECDHE) key exchange for key establishment\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Elliptic Curve Digital Signature Algorithms (ECDSA) for authentication\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"256-bit Advanced Encryption Standard in Galois/Counter mode (GCM) for confidentiality\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"384-bit Secure Hashing Algorithm for integrity\")), mdx(\"p\", null, \"With these definitions in hand, let\\u2019s walk through an RSA handshake.\"), mdx(\"h2\", {\n    \"id\": \"rsa-handshake\"\n  }, \"RSA handshake\"), mdx(\"p\", null, \"Note that none of the messages in the handshake are encrypted with a session key; they are all sent in the clear.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1075px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/e60b6/ssl_handshake_rsa.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"73.98843930635837%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHt1I2iv//EABkQAAMAAwAAAAAAAAAAAAAAAAABIRExQf/aAAgBAQABBQKZcEdYtf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAMBAQEAAAAAAAAAAAAAAAABESExUf/aAAgBAQABPyG0UGSVdGqJ4NrEZH//2gAMAwEAAgADAAAAEBvP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAMVH/2gAIAQEAAT8QElsZlwBwZzXuBbfbb3BchEcWD7v/2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"rsa-handshake\",\n    \"title\": \"rsa-handshake\",\n    \"src\": \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/e60b6/ssl_handshake_rsa.jpg\",\n    \"srcSet\": [\"/static/5d3325edae7ef03b0a5befb1d64dd7ea/fad94/ssl_handshake_rsa.jpg 346w\", \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/f9df6/ssl_handshake_rsa.jpg 691w\", \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/e60b6/ssl_handshake_rsa.jpg 1075w\"],\n    \"sizes\": \"(max-width: 1075px) 100vw, 1075px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h3\", {\n    \"id\": \"message-1-client-hello\"\n  }, \"Message 1: \\u201CClient Hello\\u201D\"), mdx(\"p\", null, \"The client hello contains the protocol version that the client wants to use, and some other information to get the handshake started including the client random and a list of cipher suites. Modern browsers also include the hostname they are looking for, called the Server Name Indication (SNI). SNI lets the web server host multiple domains on the same IP address.\"), mdx(\"h3\", {\n    \"id\": \"message-2-server-hello\"\n  }, \"Message 2: \\u201CServer Hello\\u201D\"), mdx(\"p\", null, \"After receiving the client hello, the server picks the parameters for the handshake going forward. The choice of cipher suite determines what type of handshake is performed. The server \\u201Chello\\u201D message contains the server random, the server\\u2019s chosen cipher suite, and the server\\u2019s certificate. The certificate contains the server\\u2019s public key and domain name.\"), mdx(\"h3\", {\n    \"id\": \"message-3-client-key-exchange\"\n  }, \"Message 3: \\u201CClient Key Exchange\\u201D\"), mdx(\"p\", null, \"After validating that the certificate is trusted and belongs to the site they are trying to reach, the client creates a random pre-master secret. This secret is encrypted with the public key from the certificate, and sent to the server.\"), mdx(\"p\", null, \"Upon receiving this message, the server uses its private key to decrypt this pre-master secret. Now that both sides have the pre-master secret, and both client and server randoms, they can both derive the same session key. Then they exchange a short message to indicate that the next message they send will be encrypted.\"), mdx(\"p\", null, \"The handshake is officially complete when the client and server exchange \\u201CFinished\\u201D messages. The actual text is literally: \\u201Cclient finished\\u201D or \\u201Cserver finished\\u201D encrypted with the session key. Any subsequent communication between the two parties are encrypted with the session key.\"), mdx(\"p\", null, \"This handshake is elegant because it combines key exchange and authentication in one step. The logic is that if the server can correctly derive the session key, then they must have access to the private key, and, therefore, be the owner of the certificate.\"), mdx(\"p\", null, \"The downside of this handshake is that the messages secured by it are only as safe as the private key. Suppose a third party has recorded the handshake and the subsequent communication. If that party gets access to the private key in the future, they will be able to decrypt the premaster secret and derive the session key. With that they can decrypt the entire message. This is true even if the certificate is expired or revoked. This leads us to another form of handshake that can provide confidentiality even if the private key is compromised.\"), mdx(\"h2\", {\n    \"id\": \"ephemeral-diffie-hellman-handshake\"\n  }, \"Ephemeral Diffie-Hellman handshake\"), mdx(\"p\", null, \"The ephemeral Diffie-Hellman handshake is an alternative form of the TLS handshake. It uses two different mechanisms: one for establishing a shared pre-master secret, and one for authenticating the server. The key feature that this relies on is the Diffie-Hellman key agreement algorithm.\"), mdx(\"p\", null, \"In Diffie-Hellman, two parties with different secrets exchange messages to obtain a shared secret. This handshake relies on the simple fact that exponents are commutative. Specifically that taking a number to the power of a, and the result to the power of b, is the same as taking the same number to the power of b, and the result to the power of a.\"), mdx(\"p\", null, \"The algorithm works like this:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"person a has secret a, sends g\", mdx(\"sup\", null, \"a\"), \" to person b\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"person b has secret b, sends g\", mdx(\"sup\", null, \"b\"), \" to person a\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"person a computes (g\", mdx(\"sup\", null, \"b\"), \")\", mdx(\"sup\", null, \"a\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"person b computes (g\", mdx(\"sup\", null, \"a\"), \")\", mdx(\"sup\", null, \"b\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Both person a and b end up with g\", mdx(\"sup\", null, \"ab\"), \", which is their shared secret\")), mdx(\"p\", null, \"This doesn't work well with regular numbers because g\", mdx(\"sup\", null, \"ab\"), \" can get really large, and there are efficient ways to take the nth root of a number. However, we can change the problem space and make it work. This is done by restricting the computation to numbers of a fixed size by always dividing the result of a computation by big prime number and taking the remainder. This is called modular arithmetic. Taking an nth root in modular arithmetic is called the discrete logarithm problem and is considered a hard problem.\"), mdx(\"p\", null, \"Now let\\u2019s go through a Diffie-Hellman handshake:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1228px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/45d84/ssl_handshake_diffie_hellman.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"69.65317919075144%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtojRVf//EABYQAAMAAAAAAAAAAAAAAAAAAAEQQf/aAAgBAQABBQKlUr//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAAMAAAAAAAAAAAAAAAAAAREhMUH/2gAIAQEAAT8hqbqDyRFOzJIWj//aAAwDAQACAAMAAAAQ6w//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAQADAQAAAAAAAAAAAAABEQAhMUFx/9oACAEBAAE/ECAWODiRX0wU5ZpH8K52dRmEHzf/2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"dh-handshake\",\n    \"title\": \"dh-handshake\",\n    \"src\": \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/45d84/ssl_handshake_diffie_hellman.jpg\",\n    \"srcSet\": [\"/static/ebb889bb6ec4bd14a664b3f002b30ff8/fad94/ssl_handshake_diffie_hellman.jpg 346w\", \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/f9df6/ssl_handshake_diffie_hellman.jpg 691w\", \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/45d84/ssl_handshake_diffie_hellman.jpg 1228w\"],\n    \"sizes\": \"(max-width: 1228px) 100vw, 1228px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h3\", {\n    \"id\": \"message-1-client-hello-1\"\n  }, \"Message 1: \\u201CClient Hello\\u201D\"), mdx(\"p\", null, \"Just like in the RSA case, the client hello contains the protocol version, the client random, a list of cipher suites, and, optionally, the SNI extension. If the client speaks ECDHE, they include the list of curves they support. If this is omitted, or there is a mismatch, it can be tricky to debug.\"), mdx(\"h3\", {\n    \"id\": \"message-2-server-hello-1\"\n  }, \"Message 2: \\u201CServer Hello\\u201D\"), mdx(\"p\", null, \"After receiving the client hello, the server picks the parameters for the handshake going forward, including the curve for ECDHE. The server \\u201Chello\\u201D message contains the server random, the server\\u2019s chosen cipher suite, and the server\\u2019s certificate.\"), mdx(\"p\", null, \"The RSA and Diffie-Hellman handshakes start to differ at this point with a new message type.\"), mdx(\"h3\", {\n    \"id\": \"message-3-server-key-exchange\"\n  }, \"Message 3: \\u201CServer Key Exchange\\u201D\"), mdx(\"p\", null, \"In order to start the Diffie-Hellman key exchange, the server needs to pick some starting parameters and send them to the client---this corresponds to the ga we described above. The server also needs a way to prove that it has control of the private key, so the server computes a digital signature of all the messages up to this point. Both the Diffie-Hellman parameters and the signature are sent in this message.\"), mdx(\"h3\", {\n    \"id\": \"message-4-client-key-exchange\"\n  }, \"Message 4: \\u201CClient Key Exchange\\u201D\"), mdx(\"p\", null, \"After validating that the certificate is trusted, and belongs to the site they are trying to reach, the client validates the digital signature sent from the server. They also send the client half of the Diffie-Hellman handshake (corresponding to g\", mdx(\"sup\", null, \"b\"), \" above).\"), mdx(\"p\", null, \"At this point, both sides can compute the pre-master secret from the Diffie-Hellman parameters (corresponding to g\", mdx(\"sup\", null, \"ab\"), \" above). With the pre-master secret and both client and server randoms, they can derive the same session key. They then exchange a short message to indicate that they the next message they send will be encrypted.\"), mdx(\"p\", null, \"Just like in the RSA handshake, this handshake is officially complete when the client and server exchange \\u201CFinished\\u201D messages. Any subsequent communication between the two parties are encrypted with the session key.\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"order\": 73,\n  \"pcx-content-type\": \"concept\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1 {...{\n      \"id\": \"tls\"\n    }}>{`TLS`}</h1>\n    <p>{`This description of TLS is pulled from `}<a parentName=\"p\" {...{\n        \"href\": \"https://twitter.com/grittygrease?lang=en\"\n      }}>{`Nick's`}</a>{` blog post, `}<a parentName=\"p\" {...{\n        \"href\": \"https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/\"\n      }}>{`Keyless SSL: The Nitty Gritty Technical Details`}</a>{`.`}</p>\n    <p>{`Transport Layer Security (TLS) is the workhorse of web security. It lets websites prove their identity to web browsers, and protects all information exchanged from prying eyes using encryption. The TLS protocol has been around for years, but it’s still mysterious to even hardcore tech enthusiasts. Understanding the fundamentals of TLS is the key to understanding Keyless SSL.`}</p>\n    <p>{`TLS has two main goals: confidentiality and authentication. Both are critically important to securely communicating on the Internet.`}</p>\n    <p>{`Communication is considered confidential when two parties are confident that nobody else can understand their conversation. Confidentiality can be achieved using symmetric encryption: use a key known only to the two parties involved to encrypt messages before sending them. In TLS, this symmetric encryption is typically done using a strong block cipher like `}<a parentName=\"p\" {...{\n        \"href\": \"http://en.wikipedia.org/wiki/Advanced_Encryption_Standard\"\n      }}>{`AES`}</a>{`. Older browsers and platforms might use a cipher like `}<a parentName=\"p\" {...{\n        \"href\": \"http://en.wikipedia.org/wiki/Triple_DES\"\n      }}>{`Triple DES`}</a>{` or the stream cipher `}<a parentName=\"p\" {...{\n        \"href\": \"http://en.wikipedia.org/wiki/RC4\"\n      }}>{`RC4`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"http://blog.cloudflare.com/killing-rc4-the-long-goodbye/\"\n      }}>{`which is now considered insecure`}</a>{`.`}</p>\n    <p>{`The other crucial goal of TLS is authentication. Authentication is a way to ensure the person on the other end is who they say they are. This is accomplished with public keys. Websites use certificates and public key cryptography to prove their identity to web browsers. And browsers need two things to trust a certificate: proof that the other party is the owner of the certificate, and proof that the certificate is trusted.`}</p>\n    <p>{`A website certificate contains a public key, and if the website can prove that it controls the associated private key, that’s proof that they are the owner of the certificate. A browser considers a certificate trusted if the certificate was granted by a trusted certificate authority, and contains the site’s domain name.`}</p>\n    <p>{`In the context of the web, confidentiality and authentication are achieved through the process of establishing a shared key and proving ownership of a certificate. TLS does this through a series of messages called a “handshake”.`}</p>\n    <h2 {...{\n      \"id\": \"whats-in-a-handshake\"\n    }}>{`What’s in a handshake?`}</h2>\n    <p>{`The TLS protocol evolved from the Secure Sockets Layer (SSL) protocol which was developed by Netscape in the mid-1990s. In 1999, the Internet Engineering Task Force (IETF) standardized a new protocol called TLS, which is an updated version of SSL. In fact, TLS is so similar to SSL that TLS 1.0 uses the SSL protocol version number 3.1. This may seem confusing at first, but makes sense since TLS is just a minor update to SSL 3.0. Subsequent versions of TLS have followed this pattern. Since TLS is an evolution of the SSL protocol, people still use the terms TLS and SSL somewhat interchangeably.`}</p>\n    <p>{`There are two main types of handshakes in TLS: one based on `}<a parentName=\"p\" {...{\n        \"href\": \"http://en.wikipedia.org/wiki/RSA_(cryptosystem)\"\n      }}>{`RSA`}</a>{`, and one based on `}<a parentName=\"p\" {...{\n        \"href\": \"http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange\"\n      }}>{`Diffie-Hellman`}</a>{`. RSA and Diffie-Hellman were the two algorithms which ushered in the era of modern cryptography, and brought cryptography to the masses. These two handshakes differ only in how the two goals of key establishment and authentication are achieved:`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"800px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/bb8d84c901ed3895f977512d1b13a391/5a190/ssl-table.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"18.78612716763006%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQI1yWIy0rDQABF8x3iQnDpxl2FYvGnFHEjuPBV/AkXglaJDaQI5mGtySQmxBCHCW1iO5Mhk5lJVNQfMFA4XO45ihFKI5CPgRxH9aVJ1g/szrGzdeLsXPi9PuieuZtHz6t75squsXE47vXd7jnYbvupu7ZvKShjGZZpzrKFmNHvu1eiR4UWkisbagHWIzoMycDDNwCrAR690etJOnCmbb/1sELwghZk/pEXBfn7/fmSVV2VklGUxKzADWc1Lz8Fa2l4KatyhmA+RTVnjWBKAmHyDuM4RijlQgDPd4HXrj56mLw4S13SfsO0VHWo3muW/QR8/x+ODLaV3aKnbAAAAABJRU5ErkJggg==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"ssl-table\",\n            \"title\": \"ssl-table\",\n            \"src\": \"/static/bb8d84c901ed3895f977512d1b13a391/5a190/ssl-table.png\",\n            \"srcSet\": [\"/static/bb8d84c901ed3895f977512d1b13a391/8f77f/ssl-table.png 346w\", \"/static/bb8d84c901ed3895f977512d1b13a391/e185b/ssl-table.png 691w\", \"/static/bb8d84c901ed3895f977512d1b13a391/5a190/ssl-table.png 800w\"],\n            \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`The RSA and DH handshakes both have their advantages and disadvantages. The RSA handshake only uses one public key algorithm operation, RSA. A DH handshake with an RSA certificate requires the same RSA operation, but with an additional DH operation. Given that the certificate is RSA, the RSA handshake is faster to compute. Public key algorithms like RSA and DH use a lot of CPU and are the slowest part of the TLS handshake. A laptop can only perform a couple hundred RSA encryptions a second versus around ten million per second of the symmetric cipher AES.`}</p>\n    <p>{`The DH handshake requires two algorithms to run, but the advantage it brings is that it allows key establishment to happen independently of the server’s private key. This gives the connection `}<a parentName=\"p\" {...{\n        \"href\": \"http://blog.cloudflare.com/staying-on-top-of-tls-attacks/\"\n      }}>{`forward secrecy`}</a>{`, a useful property that protects conversations from being decrypted after the fact if the private key is somehow exposed. The DH version of the handshake also opens up the possibility of using non-RSA certificates that can improve performance, including `}<a parentName=\"p\" {...{\n        \"href\": \"http://blog.cloudflare.com/ecdsa-the-digital-signature-algorithm-of-a-better-internet/\"\n      }}>{`ECDSA keys`}</a>{`. Elliptic curves provide the same security with less computational overhead. A DH handshake with and elliptic curve DSA certificate and elliptic curve Diffie-Hellman key agreement can be faster than a one-operation RSA handshake.`}</p>\n    <h2 {...{\n      \"id\": \"tls-glossary\"\n    }}>{`TLS Glossary`}</h2>\n    <h3 {...{\n      \"id\": \"1-session-key\"\n    }}>{`1. Session key`}</h3>\n    <p>{`This is the end result of a handshake. It’s a key for a symmetric cipher, and allows the client and server to encrypt messages to each other.`}</p>\n    <h3 {...{\n      \"id\": \"2-client-random\"\n    }}>{`2. Client random`}</h3>\n    <p>{`This is a sequence of 32 bytes created by the client. It’s unique for each connection, and is supposed to contain a four-byte timestamp followed by 28 random bytes. Recently, Google Chrome switched to using 32 bytes of random in order to prevent client fingerprinting. These random values are often called a `}<a parentName=\"p\" {...{\n        \"href\": \"http://en.wikipedia.org/wiki/Cryptographic_nonce\"\n      }}>{`nonce`}</a>{`.`}</p>\n    <h3 {...{\n      \"id\": \"3-server-random\"\n    }}>{`3. Server random`}</h3>\n    <p>{`A server random is the same as the client random except generated by the server.`}</p>\n    <h3 {...{\n      \"id\": \"4-pre-master-secret\"\n    }}>{`4. Pre-master secret`}</h3>\n    <p>{`This is a 48-byte blob of data. It can be combined with both the client random and the server random to create the session key using a “pseudorandom function” (PRF).`}</p>\n    <h3 {...{\n      \"id\": \"5-cipher-suite\"\n    }}>{`5. Cipher suite`}</h3>\n    <p>{`This is a unique identifier for combining algorithms making up a TLS connection. It defines one algorithm for each of the following:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`key establishment (typically a Diffie-Hellman variant or RSA)`}</li>\n      <li parentName=\"ul\">{`authentication (the certificate type)`}</li>\n      <li parentName=\"ul\">{`confidentiality (a symmetric cipher)`}</li>\n      <li parentName=\"ul\">{`integrity (a hash function)`}</li>\n    </ul>\n    <p>{`For example “AES128-SHA” defines a session that uses`}</p>\n    <ul>\n      <li parentName=\"ul\">{`RSA for key establishment (implied)`}</li>\n      <li parentName=\"ul\">{`RSA for authentication (implied)`}</li>\n      <li parentName=\"ul\">{`128-bit Advanced Encryption Standard in Cipher Block Chaining (CBC) mode for confidentiality`}</li>\n      <li parentName=\"ul\">{`160-bit Secure Hashing Algorithm (SHA) for integrity`}</li>\n    </ul>\n    <p>{`A more daunting, but valid cipher suite is “ECDHE-ECDSA-AES256-GCM-SHA384” which defines a session that uses:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Elliptic Curve Diffie-Hellman Ephemeral (ECDHE) key exchange for key establishment`}</li>\n      <li parentName=\"ul\">{`Elliptic Curve Digital Signature Algorithms (ECDSA) for authentication`}</li>\n      <li parentName=\"ul\">{`256-bit Advanced Encryption Standard in Galois/Counter mode (GCM) for confidentiality`}</li>\n      <li parentName=\"ul\">{`384-bit Secure Hashing Algorithm for integrity`}</li>\n    </ul>\n    <p>{`With these definitions in hand, let’s walk through an RSA handshake.`}</p>\n    <h2 {...{\n      \"id\": \"rsa-handshake\"\n    }}>{`RSA handshake`}</h2>\n    <p>{`Note that none of the messages in the handshake are encrypted with a session key; they are all sent in the clear.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1075px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/e60b6/ssl_handshake_rsa.jpg\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"73.98843930635837%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHt1I2iv//EABkQAAMAAwAAAAAAAAAAAAAAAAABIRExQf/aAAgBAQABBQKZcEdYtf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAMBAQEAAAAAAAAAAAAAAAABESExUf/aAAgBAQABPyG0UGSVdGqJ4NrEZH//2gAMAwEAAgADAAAAEBvP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAMVH/2gAIAQEAAT8QElsZlwBwZzXuBbfbb3BchEcWD7v/2Q==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"rsa-handshake\",\n            \"title\": \"rsa-handshake\",\n            \"src\": \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/e60b6/ssl_handshake_rsa.jpg\",\n            \"srcSet\": [\"/static/5d3325edae7ef03b0a5befb1d64dd7ea/fad94/ssl_handshake_rsa.jpg 346w\", \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/f9df6/ssl_handshake_rsa.jpg 691w\", \"/static/5d3325edae7ef03b0a5befb1d64dd7ea/e60b6/ssl_handshake_rsa.jpg 1075w\"],\n            \"sizes\": \"(max-width: 1075px) 100vw, 1075px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <h3 {...{\n      \"id\": \"message-1-client-hello\"\n    }}>{`Message 1: “Client Hello”`}</h3>\n    <p>{`The client hello contains the protocol version that the client wants to use, and some other information to get the handshake started including the client random and a list of cipher suites. Modern browsers also include the hostname they are looking for, called the Server Name Indication (SNI). SNI lets the web server host multiple domains on the same IP address.`}</p>\n    <h3 {...{\n      \"id\": \"message-2-server-hello\"\n    }}>{`Message 2: “Server Hello”`}</h3>\n    <p>{`After receiving the client hello, the server picks the parameters for the handshake going forward. The choice of cipher suite determines what type of handshake is performed. The server “hello” message contains the server random, the server’s chosen cipher suite, and the server’s certificate. The certificate contains the server’s public key and domain name.`}</p>\n    <h3 {...{\n      \"id\": \"message-3-client-key-exchange\"\n    }}>{`Message 3: “Client Key Exchange”`}</h3>\n    <p>{`After validating that the certificate is trusted and belongs to the site they are trying to reach, the client creates a random pre-master secret. This secret is encrypted with the public key from the certificate, and sent to the server.`}</p>\n    <p>{`Upon receiving this message, the server uses its private key to decrypt this pre-master secret. Now that both sides have the pre-master secret, and both client and server randoms, they can both derive the same session key. Then they exchange a short message to indicate that the next message they send will be encrypted.`}</p>\n    <p>{`The handshake is officially complete when the client and server exchange “Finished” messages. The actual text is literally: “client finished” or “server finished” encrypted with the session key. Any subsequent communication between the two parties are encrypted with the session key.`}</p>\n    <p>{`This handshake is elegant because it combines key exchange and authentication in one step. The logic is that if the server can correctly derive the session key, then they must have access to the private key, and, therefore, be the owner of the certificate.`}</p>\n    <p>{`The downside of this handshake is that the messages secured by it are only as safe as the private key. Suppose a third party has recorded the handshake and the subsequent communication. If that party gets access to the private key in the future, they will be able to decrypt the premaster secret and derive the session key. With that they can decrypt the entire message. This is true even if the certificate is expired or revoked. This leads us to another form of handshake that can provide confidentiality even if the private key is compromised.`}</p>\n    <h2 {...{\n      \"id\": \"ephemeral-diffie-hellman-handshake\"\n    }}>{`Ephemeral Diffie-Hellman handshake`}</h2>\n    <p>{`The ephemeral Diffie-Hellman handshake is an alternative form of the TLS handshake. It uses two different mechanisms: one for establishing a shared pre-master secret, and one for authenticating the server. The key feature that this relies on is the Diffie-Hellman key agreement algorithm.`}</p>\n    <p>{`In Diffie-Hellman, two parties with different secrets exchange messages to obtain a shared secret. This handshake relies on the simple fact that exponents are commutative. Specifically that taking a number to the power of a, and the result to the power of b, is the same as taking the same number to the power of b, and the result to the power of a.`}</p>\n    <p>{`The algorithm works like this:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`person a has secret a, sends g`}<sup>{`a`}</sup>{` to person b`}</li>\n      <li parentName=\"ul\">{`person b has secret b, sends g`}<sup>{`b`}</sup>{` to person a`}</li>\n      <li parentName=\"ul\">{`person a computes (g`}<sup>{`b`}</sup>{`)`}<sup>{`a`}</sup></li>\n      <li parentName=\"ul\">{`person b computes (g`}<sup>{`a`}</sup>{`)`}<sup>{`b`}</sup></li>\n      <li parentName=\"ul\">{`Both person a and b end up with g`}<sup>{`ab`}</sup>{`, which is their shared secret`}</li>\n    </ul>\n    <p>{`This doesn't work well with regular numbers because g`}<sup>{`ab`}</sup>{` can get really large, and there are efficient ways to take the nth root of a number. However, we can change the problem space and make it work. This is done by restricting the computation to numbers of a fixed size by always dividing the result of a computation by big prime number and taking the remainder. This is called modular arithmetic. Taking an nth root in modular arithmetic is called the discrete logarithm problem and is considered a hard problem.`}</p>\n    <p>{`Now let’s go through a Diffie-Hellman handshake:`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1228px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/45d84/ssl_handshake_diffie_hellman.jpg\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"69.65317919075144%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtojRVf//EABYQAAMAAAAAAAAAAAAAAAAAAAEQQf/aAAgBAQABBQKlUr//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAAMAAAAAAAAAAAAAAAAAAREhMUH/2gAIAQEAAT8hqbqDyRFOzJIWj//aAAwDAQACAAMAAAAQ6w//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAQADAQAAAAAAAAAAAAABEQAhMUFx/9oACAEBAAE/ECAWODiRX0wU5ZpH8K52dRmEHzf/2Q==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"dh-handshake\",\n            \"title\": \"dh-handshake\",\n            \"src\": \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/45d84/ssl_handshake_diffie_hellman.jpg\",\n            \"srcSet\": [\"/static/ebb889bb6ec4bd14a664b3f002b30ff8/fad94/ssl_handshake_diffie_hellman.jpg 346w\", \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/f9df6/ssl_handshake_diffie_hellman.jpg 691w\", \"/static/ebb889bb6ec4bd14a664b3f002b30ff8/45d84/ssl_handshake_diffie_hellman.jpg 1228w\"],\n            \"sizes\": \"(max-width: 1228px) 100vw, 1228px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <h3 {...{\n      \"id\": \"message-1-client-hello-1\"\n    }}>{`Message 1: “Client Hello”`}</h3>\n    <p>{`Just like in the RSA case, the client hello contains the protocol version, the client random, a list of cipher suites, and, optionally, the SNI extension. If the client speaks ECDHE, they include the list of curves they support. If this is omitted, or there is a mismatch, it can be tricky to debug.`}</p>\n    <h3 {...{\n      \"id\": \"message-2-server-hello-1\"\n    }}>{`Message 2: “Server Hello”`}</h3>\n    <p>{`After receiving the client hello, the server picks the parameters for the handshake going forward, including the curve for ECDHE. The server “hello” message contains the server random, the server’s chosen cipher suite, and the server’s certificate.`}</p>\n    <p>{`The RSA and Diffie-Hellman handshakes start to differ at this point with a new message type.`}</p>\n    <h3 {...{\n      \"id\": \"message-3-server-key-exchange\"\n    }}>{`Message 3: “Server Key Exchange”`}</h3>\n    <p>{`In order to start the Diffie-Hellman key exchange, the server needs to pick some starting parameters and send them to the client---this corresponds to the ga we described above. The server also needs a way to prove that it has control of the private key, so the server computes a digital signature of all the messages up to this point. Both the Diffie-Hellman parameters and the signature are sent in this message.`}</p>\n    <h3 {...{\n      \"id\": \"message-4-client-key-exchange\"\n    }}>{`Message 4: “Client Key Exchange”`}</h3>\n    <p>{`After validating that the certificate is trusted, and belongs to the site they are trying to reach, the client validates the digital signature sent from the server. They also send the client half of the Diffie-Hellman handshake (corresponding to g`}<sup>{`b`}</sup>{` above).`}</p>\n    <p>{`At this point, both sides can compute the pre-master secret from the Diffie-Hellman parameters (corresponding to g`}<sup>{`ab`}</sup>{` above). With the pre-master secret and both client and server randoms, they can derive the same session key. They then exchange a short message to indicate that they the next message they send will be encrypted.`}</p>\n    <p>{`Just like in the RSA handshake, this handshake is officially complete when the client and server exchange “Finished” messages. Any subsequent communication between the two parties are encrypted with the session key.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}