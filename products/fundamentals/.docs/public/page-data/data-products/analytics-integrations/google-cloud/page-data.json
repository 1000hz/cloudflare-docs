{"componentChunkName":"component---src-components-mdx-custom-renderer-js","path":"/data-products/analytics-integrations/google-cloud","result":{"data":{"mdx":{"id":"95427e03-6f53-5e14-a1db-bc846aef3397","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Google Cloud\",\n  \"order\": 100\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"google-cloud\"\n  }, \"Google Cloud\"), mdx(\"h2\", {\n    \"id\": \"overview\"\n  }, \"Overview\"), mdx(\"p\", null, \"This tutorial covers how to configure certain Google Cloud Platform (GCP) components so that you can analyze your Cloudflare Logs data.\"), mdx(\"p\", null, \"Before proceeding, you need to enable \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/logs/get-started/enable-destinations/google-cloud-storage\"\n  }, \"Cloudflare Logpush in Google Cloud Storage\"), \" to ensure your log data is available for analyzing.\"), mdx(\"p\", null, \"The components we'll use in this tutorial include:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Google Cloud Function\"), \" to import logs from Google Cloud Storage to Google BigQuery\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Google BigQuery\"), \" to make log data available to the reporting engine, and\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Google Data Studio\"), \" to run interactive reports\")), mdx(\"p\", null, \"The following diagram depicts how data flows from Cloudflare Logs through the different components of the Google Cloud Platform discussed in this tutorial.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1382px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/8857f8a05529c1f5d0871d660b601ec1/460fa/cf-logpush-to-google-cloud-platform.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"73.41040462427746%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADYklEQVQ4y0VUTW8cRRCdOxfOiEMcJWHt6Znpnu/p+diZ2Z31rjdrnI1j2QSs2EkgWkUKl1ywCEJRAIEBARcOKAoSuQASnEBC4heAxJUbyj/gHzzetEEcWt1d1V1d9d6rtrbrFMLx4QoF99/Zc/2ztfPfWkF5IRz6JOezM4EZvc9XsVn3fqtrOiiVwnFDKD+F58VcR2a4tLmcbRFCuDFc+nqbEMHZ7ASwbQmHj/c2R/iw2nYKFVYoqg7taAadN+ayH1WYzZeYbC6QhdzLCFU1RpzWkEHJs1vI8jH8QCN0PUTChhQurDgd4svHT/Hx6SewNzx005eR6Ro+s510cxT1AtHhKbKbnyMd7WLcTBi4w3h8GcPhhPsO8d4JktUTyPYA1hff/IQn3/2M27dXePjpV/j9r7/x+PtfoBk0iVIoZnBRX4Fd78NPauhEIwozg2mPW6QCnG+OcXHvfYjqKqyDGyus7j/E0fEb+OPPZ/jx199w/cYdZusiS0uSQDxZrgpZWqSR6yFizjqrEAapWfc4h1HJqhJYFy45eP3ufVx/9Rg3j24hpPGAa8nXlSTwBF3IDG5QcB8xo9DYwyAxGfoqIjkRPD+HlAy4uXOI+eIay6OBLGpiVo6XSIhtkbfISVKWVsafVVvQzQ6iuEJZjIyvtxfNAsVoSXgKymY0Rdtsoq07lATb230bwSuPkJQz1NUIZTkmZhoBtSYX9xCQoLhZoh2OkGU1Qmbrze8ieO1DyGpJlonB2cgM2BuSmcYtIr6ssxJpkhtfj5ftskxKLKQvpy/wYyN8mzLr7crPYJVFy9JqFAS7J0EobdiMk5LZtSZoEudmOCrjY0MkSYFuNMFkvMnSG7i0K95RAQP6njREyL5LmH6vP8mXlKsQULB9W/VkeOwGXzFD+pyeBKl5ruRdQqESc8ejIiw/W2B9QyIZrEOrgiWT0Q2BjWSKQbkHQfkItlRS1sxEw1l3UHc1Tu7FOJytsatSVGX1fy9Xt75FUmyhzObQ2ydwp5SOp3D+6ns4t/8ZwvIynHwBdXQKQfB14OHpgxex2hf44cHzsFluVTeUWWg+FCvZfYSAAQbpHOeuvEssRpC2wKXZm7hw7QN+HPwQqLG17XfglDsYvKTw0Z0X8Ozr5/DW4RoGIkMca6PXPuA/kGAJvMLWDOwAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Cloudflare Logpush to Google Cloud Platform\",\n    \"title\": \"Cloudflare Logpush to Google Cloud Platform\",\n    \"src\": \"/static/8857f8a05529c1f5d0871d660b601ec1/f868f/cf-logpush-to-google-cloud-platform.png\",\n    \"srcSet\": [\"/static/8857f8a05529c1f5d0871d660b601ec1/8f77f/cf-logpush-to-google-cloud-platform.png 346w\", \"/static/8857f8a05529c1f5d0871d660b601ec1/e185b/cf-logpush-to-google-cloud-platform.png 691w\", \"/static/8857f8a05529c1f5d0871d660b601ec1/f868f/cf-logpush-to-google-cloud-platform.png 1382w\", \"/static/8857f8a05529c1f5d0871d660b601ec1/460fa/cf-logpush-to-google-cloud-platform.png 1910w\"],\n    \"sizes\": \"(max-width: 1382px) 100vw, 1382px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(Aside, {\n    type: \"info\",\n    header: \"Info\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"Google Cloud is offering a credit towards a new Google Cloud account to help you get started. To learn more, visit \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://cloud.google.com/partners/partnercredit/?PCN=a0n60000003kp9MAAQ\"\n  }, \"Google Cloud Platform Partner Credit\"), \".\")), mdx(\"h2\", {\n    \"id\": \"task-1---use-google-cloud-function-to-import-log-data-into-google-bigquery\"\n  }, \"Task 1 - Use Google Cloud Function to import log data into Google BigQuery\"), mdx(\"p\", null, \"After you configured Cloudflare Logpush to send your logs to a Google Cloud Storage bucket, your log data updates every five minutes by default.\"), mdx(\"p\", null, \"Google BigQuery makes data available for both querying using Structured Query Language (SQL) and for configuring as a data source for the Google Data Studio reporting engine. BigQuery is a highly scalable cloud database where SQL queries run quite fast.\"), mdx(\"p\", null, \"Importing data from Google Cloud Storage into Google BigQuery requires creating a function using Google Cloud Function and running it in the Google Cloud Shell. This function triggers every time new Cloudflare log data is uploaded to your Google Cloud Storage bucket.\"), mdx(\"h3\", {\n    \"id\": \"clone-and-deploy-a-google-cloud-function\"\n  }, \"Clone and deploy a Google Cloud Function\"), mdx(\"p\", null, \"To a create a cloud function to import data from Google Cloud Storage into Google BigQuery, you will need the following GitHub repository from Cloudflare: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/cloudflare/GCS-To-Big-Query\"\n  }, \"https://github.com/cloudflare/GCS-To-Big-Query\"), \".\"), mdx(\"p\", null, \"To clone and deploy the cloud function:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Run the Google Cloud Platform shell by opening the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Cloud Platform\"), \" console and clicking the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Shell\"), \" icon (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Activate Cloud Shell\"), \").\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Run the following command to download the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"master\"), \" zipped archive, uncompress the files to new a directory, and change the command line prompt to the new directory: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"curl -LO \\\"https://github.com/cloudflare/cloudflare-gcp/archive/master.zip\\\" && unzip master.zip && cd cloudflare-gcp-master/logpush-to-bigquery\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Next, edit the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"deploy.sh\"), \" file and make sure that:\"))), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"BUCKET_NAME\"), \" is set to the bucket you created when you configured Cloudflare Logpush with Google Cloud Platform.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"DATASET\"), \" and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"TABLE\"), \" are unique names.\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"The contents of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"deploy.sh\"), \" should look similar to this:\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \".\\n.\\n.\\nBUCKET_NAME=\\\"my_cloudflarelogs_gcp_storage_bucket\\\"\\nDATASET=\\\"my_cloudflare_logs\\\"\\nTABLE=\\\"cloudflare_logs\\\"\\n.\\n.\\n.\\n\")))), mdx(\"ol\", {\n    \"start\": 4\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Then in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Shell\"), \", run the following command to deploy your instance of the cloud function:\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"sh ./deploy.sh\\n\")))), mdx(\"p\", null, \"Once you've deployed your new cloud function, verify that it appears in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Cloud Functions\"), \" interface by navigating to \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Cloud Platform\"), \" > \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Compute\"), \" > \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Cloud Functions\"), \".\"), mdx(\"p\", null, \"Also, verify that the data now appears in your table in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"BigQuery\"), \" by navigating to the appropriate project in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Cloud Platform\"), \" > \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Big Data\"), \" > \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"BigQuery\"), \".\"), mdx(\"p\", null, \"If everything is configured correctly, you can now query any request or visualize data with Google Data Studio or any other analytics tool that supports BigQuery as an input source.\"), mdx(\"h3\", {\n    \"id\": \"add-fields-in-google-cloud-function\"\n  }, \"Add fields in Google Cloud Function\"), mdx(\"p\", null, \"To add fields in Cloud Function, edit the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"schema.json\"), \" file.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Open Google Cloud Function.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Select the function you want to update.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"EDIT\"), \" on the Function details page.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Select \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"schema.json\"), \" from the list of files.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In the file editor, enter the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"name\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"type\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"mode\"), \" of any fields you would like to add. Follow the format shown in the file.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Deploy\"), \".\"))), mdx(\"p\", null, \"To debug in Cloud Function, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"VIEW LOGS\"), \" on the Function details page. This will take you to the Logs Viewer, where any errors will appear.\"), mdx(\"h3\", {\n    \"id\": \"add-fields-in-bigquery\"\n  }, \"Add fields in BigQuery\"), mdx(\"p\", null, \"To add fields in BigQuery, edit the schema.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Open BigQuery.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In the menu, expand \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"your-project-name\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Expand \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"cloudflare_data\"), \" and click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"cf_analytics_logs\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Select the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Schema\"), \" tab.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Scroll to the bottom of the page, and click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Edit schema\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"On the pop-up page, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Add field\"), \". Enter the field \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Name\"), \" and select the field \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Type\"), \" and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Mode\"), \" from the dropdowns.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Save\"), \".\"))), mdx(\"h2\", {\n    \"id\": \"task-2---analyze-log-data-with-google-data-studio\"\n  }, \"Task 2 - Analyze log data with Google Data Studio\"), mdx(\"p\", null, \"To analyze and visualize logs, you can use \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Data Studio\"), \" or any other 3rd party services that supports Google BigQuery as an input source.\"), mdx(\"p\", null, \"With Google Data Studio, you can generate graphs and charts from a Google BigQuery table. You can also refresh the data in your reports and get real-time analytics.\"), mdx(\"h3\", {\n    \"id\": \"about-the-cloudflare-logs-insights-template\"\n  }, \"About the Cloudflare Logs Insights Template\"), mdx(\"p\", null, \"Cloudflare has published a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://datastudio.google.com/u/0/reporting/1ez3m7Yf8AZLfM6aYRjfgF0pPpRvOwhTh/page/mAzI/preview\"\n  }, \"Logs Insights Template\"), \" in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Data Studio Report Gallery\"), \".\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"../../../static/images/cf-logs-insights-template.png\",\n    \"alt\": \"Cloudflare Logs Insights Template on Google Data Studio Gallery\"\n  })), mdx(\"p\", null, \"The Cloudflare Insights Template features several dashboards, or report pages, to help you analyze your Cloudflare Logs data. You can also use filters within the dashboards to narrow down the analysis by date and time, device type, country, user agent, client IP, hostname, and more. These insights further help with debugging and tracing.\"), mdx(\"p\", null, \"The following dashboards are included in the Insights template:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Snapshot\"), \": Gives you an overview of the most important metrics from your Cloudflare logs, including total number of requests, top visitors by geography, IP, user agent, traffic type, total number of threats, and bandwidth usage.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Security\"), \": Provides insights on threat identification and mitigations by our \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Web Application Firewall\"), \", including \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Firewall Rules\"), \", \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Rate Limiting\"), \", and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"IP Firewall\"), \". Metrics include total threats stopped, threat traffic source, blocked IPs and user agents, top threat requests, Firewall events (SQL injections, XSS, etc.), and rate limiting. Use this data to fine tune the firewall to target obvious threats and avoid false positives.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Performance\"), \": Helps you identify and address issues like slow pages and caching misconfigurations. Metrics include total vs. cached bandwidth, cache ratio, top uncached requests, static vs. dynamic content, slowest URIs, and more.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Reliability\"), \": Provides insights on the availability of your websites and applications. Metrics include origin response error ratio, origin response status over time, percentage of 3xx/4xx/5xx errors over time, and more.\"))), mdx(\"h3\", {\n    \"id\": \"create-a-report-based-on-the-insights-template\"\n  }, \"Create a report based on the Insights Template\"), mdx(\"p\", null, \"To create a report for your log data based on the Cloudflare template:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In Data Studio, open the Cloudflare \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://datastudio.google.com/u/0/reporting/1ez3m7Yf8AZLfM6aYRjfgF0pPpRvOwhTh/page/mAzI/preview\"\n  }, \"template\"), \" and click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Use Template\"), \". A \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Create new report\"), \" dialog opens.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Under the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"New Data Source\"), \" dropdown, select \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Create New Data Source\"), \". A page opens where you can enter additional configuration details.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Under \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Google Connectors\"), \", locate the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"BigQuery\"), \" card and click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Select\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Next under \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"MY PROJECTS\"), \", select your \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Project\"), \", \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Dataset\"), \", and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Table\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Connect\"), \" in the upper right.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In the list of Cloudflare Logs fields, locate \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"EdgeStartTimestamp\"), \", click the three vertical dots and select \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Duplicate\"), \". This creates \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Copy of EdgeStartTimestamp\"), \" right below \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"EdgeStartTimestamp\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Update the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Type\"), \" for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Copy of EdgeStartTimestamp\"), \" to set it to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Date & Time\"), \" > \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Date Hour (YYYYMMDDHH)\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Next, update the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Type\"), \" for each of the following fields as indicated below:\"))), mdx(\"table\", {\n    style: {\n      \"border\": \"solid 2px darkgrey\",\n      \"width\": \"100%\"\n    }\n  }, mdx(\"thead\", {\n    style: {\n      \"background\": \"#ffeadf\"\n    }\n  }, mdx(\"tr\", null, mdx(\"th\", null, \"Cloudflare Log Field\"), mdx(\"th\", null, \"Type\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, \"ZoneID\"), mdx(\"td\", null, \"Text\")), mdx(\"tr\", null, mdx(\"td\", null, \"EdgeColoID\"), mdx(\"td\", null, \"Text\")), mdx(\"tr\", null, mdx(\"td\", null, \"ClientSrcPort\"), mdx(\"td\", null, \"Text\")), mdx(\"tr\", null, mdx(\"td\", null, \"EdgeResponseStatus\"), mdx(\"td\", null, \"Number\")), mdx(\"tr\", null, mdx(\"td\", null, \"EdgeRateLimitID\"), mdx(\"td\", null, \"Text\\xA0\")), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"div\", null, mdx(\"div\", null, \"Copy of EdgeStartTimestamp\"))), mdx(\"td\", null, \"Date & Time > Date Hour (YYYYMMDDHH)\")), mdx(\"tr\", null, mdx(\"td\", null, \"OriginResponseStatus\"), mdx(\"td\", null, \"Number\")), mdx(\"tr\", null, mdx(\"td\", null, \"ClientASN\"), mdx(\"td\", null, \"Text\")), mdx(\"tr\", null, mdx(\"td\", null, \"ClientCountry\"), mdx(\"td\", null, \"Geo > Country\")), mdx(\"tr\", null, mdx(\"td\", null, \"CacheResponseStatus\"), mdx(\"td\", null, \"Text\")))), mdx(\"ol\", {\n    \"start\": 9\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Next, add a new field to identify and calculate threat. In the top right corner, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"+ ADD A FIELD\"), \", then in the add field UI:\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \" For \", mdx(\"strong\", {\n    parentName: \"em\"\n  }, \"Field Name\"), \", type \", mdx(\"em\", {\n    parentName: \"em\"\n  }, \"Threats\"), \".\\n\"), \" In the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Formula\"), \" text box, paste the following code:\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"CASE\\nWHEN EdgePathingSrc = \\\"user\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"ip\\\" THEN \\\"ip block\\\"\\nWHEN EdgePathingSrc = \\\"user\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"ctry\\\" THEN \\\"country block\\\"\\nWHEN EdgePathingSrc = \\\"user\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"zl\\\" THEN \\\"routed by zone lockdown\\\"\\n WHEN EdgePathingSrc = \\\"user\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"ua\\\" THEN \\\"blocked user agent\\\"\\nWHEN EdgePathingSrc = \\\"user\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"rateLimit\\\" THEN \\\"rate-limiting rule\\\"\\n WHEN EdgePathingSrc = \\\"bic\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"unknown\\\" THEN \\\"browser integrity check\\\"\\nWHEN EdgePathingSrc = \\\"hot\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"unknown\\\" THEN \\\"blocked hotlink\\\"\\nWHEN EdgePathingSrc = \\\"macro\\\" AND EdgePathingOp = \\\"chl\\\" AND EdgePathingStatus = \\\"captchaFail\\\" THEN \\\"CAPTCHA challenge failed\\\"\\nWHEN EdgePathingSrc = \\\"macro\\\" AND EdgePathingOp = \\\"chl\\\" AND EdgePathingStatus = \\\"jschlFail\\\" THEN \\\"java script challenge failed\\\"\\nWHEN EdgePathingSrc = \\\"filterBasedFirewall\\\" AND EdgePathingOp = \\\"ban\\\" AND EdgePathingStatus = \\\"unknown\\\" THEN \\\"blocked by filter based firewall\\\"\\nWHEN EdgePathingSrc = \\\"filterBasedFirewall\\\" AND EdgePathingOp = \\\"chl\\\" THEN \\\"challenged by filter based firewall\\\"\\nElse \\\"Other\\\"\\nEND\\n\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"*\", \" Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Save\"), \" in the lower right corner.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Finally, add another new field for grouping status error codes. In the top right corner, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"+ ADD A FIELD\"), \", then in the add field UI:\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \" For \", mdx(\"strong\", {\n    parentName: \"em\"\n  }, \"Field Name\"), \", type \", mdx(\"em\", {\n    parentName: \"em\"\n  }, \"EdgeResponseStatus_Class\"), \".\\n\"), \" In the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Formula\"), \" text box, paste the following code:\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"CASE\\nWHEN EdgeResponseStatus > 199 AND EdgeResponseStatus < 300 THEN \\\"2xx\\\"\\nWHEN EdgeResponseStatus > 299 AND EdgeResponseStatus < 400 THEN \\\"3xx\\\"\\nWHEN EdgeResponseStatus > 399 AND EdgeResponseStatus < 500 THEN \\\"4xx\\\"\\nWHEN EdgeResponseStatus > 499 AND EdgeResponseStatus < 600 THEN \\\"5xx\\\"\\nWHEN EdgeResponseStatus = 0 THEN \\\"0 - Served from CF Edge\\\"\\nElse \\\"Other\\\"\\nEND\\n\")))), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Save\"), \" in the lower right corner.\")), mdx(\"ol\", {\n    \"start\": 11\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"To finish, click \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Add to Report\"), \" in the upper right.\")), mdx(\"h3\", {\n    \"id\": \"refreshing-fields-and-filters-manually\"\n  }, \"Refreshing fields and filters manually\"), mdx(\"p\", null, \"After you've added your report, you will notice that not all report components render successfully. To fix this, you need to resolve any errors related to invalid dimensions, metrics, or filters that appear in the affected report components.\"), mdx(\"h4\", {\n    \"id\": \"update-data-studio-with-new-fields\"\n  }, \"Update Data Studio with new fields\"), mdx(\"p\", null, \"To update Data Studio with fields added to BigQuery, refresh fields for the data source.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In Data Studio, open the Cloudflare dashboard in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Edit\"), \" mode.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Expand the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Resource\"), \" menu and select \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Manage added data sources\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"EDIT\"), \" action for the data source that you want to update.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"REFRESH FIELDS\"), \" below the table. A window with \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Field changes found\"), \" in BigQuery will pop up.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"To add the new fields, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"APPLY\"), \".\"))), mdx(\"p\", null, \"You can also create custom fields directly in Data Studio.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In Data Studio, open the Cloudflare dashboard in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Edit\"), \" mode.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Expand the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Resource\"), \" menu and select \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Manage added data sources\"), \".\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"EDIT\"), \" action for the data source that you want to add a custom field to.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"ADD A FIELD\"), \" above the table.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Enter a formula in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Formula\"), \" editor.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"SAVE\"), \".\"))), mdx(\"h4\", {\n    \"id\": \"fix-invalid-metric-or-dimension-errors\"\n  }, \"Fix invalid metric or dimension errors\"), mdx(\"p\", null, \"The following table summarizes which specific components require to be fixed:\"), mdx(\"table\", {\n    style: {\n      \"border\": \"solid 2px darkgrey\",\n      \"width\": \"100%\"\n    }\n  }, mdx(\"thead\", {\n    style: {\n      \"background\": \"#ffeadf\"\n    }\n  }, mdx(\"tr\", null, mdx(\"th\", null, \"Report page\"), mdx(\"th\", null, \"Components\"), mdx(\"th\", null, \"Field to add\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", {\n    rowSpan: \"3\"\n  }, \"2 Security Cloudflare\\xA0\"), mdx(\"td\", null, mdx(\"p\", null, mdx(\"em\", null, \"Threats \"), \"(scorecard)\")), mdx(\"td\", null, \"\\xA0Threats (Metric)\")), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"p\", null, mdx(\"em\", null, \"Threats - Record Count (table)\"))), mdx(\"td\", null, \"\\xA0Threats (Dimension)\")), mdx(\"tr\", null, mdx(\"td\", null, \"\\xA0\", mdx(\"em\", null, \"Threats Over Time\\xA0\"), \"(area chart)\"), mdx(\"td\", null, \"\\xA0Threats (Breadown Dimension)\")), mdx(\"tr\", null, mdx(\"td\", null, \"3 Reliability Cloudflare\"), mdx(\"td\", null, mdx(\"em\", null, \"Status Codes Last 24 hours\\xA0\"), \"(bar chart)\"), mdx(\"td\", null, mdx(\"em\", null, \"Copy of EdgeStartTimeStamp\\xA0\"), \"(Dimension)\")), mdx(\"tr\", null, mdx(\"td\", null, \"5\\xA0Last 100s Requests Cloudflare\"), mdx(\"td\", null, mdx(\"em\", null, \"Last 100 Requests\"), \" (table)\"), mdx(\"td\", null, \"\\xA0\", mdx(\"em\", null, \"Copy of EdgeStartTimeStamp\"))))), mdx(\"p\", null, \"For each of the report components listed above:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Select the report component affected.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"On the menu to the right, under the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Data\"), \" tab, locate and click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Invalid Dimension\"), \" or \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Invalid Metric\"), \" (as applicable). The \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Field Picker\"), \" panel opens.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Search or type for the field to add, then click to select it.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"To finish, click away from the panel to return to the main report.\"))), mdx(\"p\", null, \"The component should now render correctly.\"), mdx(\"h4\", {\n    \"id\": \"update-data-filters\"\n  }, \"Update data filters\"), mdx(\"p\", null, \"This fix applies to report page: \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"3 Reliability Cloudflare\"), \", for the following scorecard components in the report:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"5xx Errors\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"4xx Errors\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"3xx Errors\"))), mdx(\"p\", null, \"To update the filter associated with each scorecard:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Select the report component affected.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"On the menu to the right, under the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Data\"), \" tab, locate the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Filters\"), \" > \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Scorecard Filter\"), \" section and click the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"pencil\"), \" next to the filter name to edit it. The \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Edit Filter\"), \" panel opens.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"In the filtering criteria section, click the dropdown and scroll or search for the field \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"EdgeResponseStatusClass\"), \" and select it.\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"To finish, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Save\"), \" in the lower right corner.\"))), mdx(\"p\", null, \"The component should now render correctly.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"Google Cloud","type":null,"updated":null}}},"pageContext":{"id":"95427e03-6f53-5e14-a1db-bc846aef3397","fields":{"slug":"/data-products/analytics-integrations/google-cloud"},"frontmatter":{"title":"Google Cloud","type":null,"order":100,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Google Cloud","depth":1}],"tableOfContents":{"items":[{"url":"#google-cloud","title":"Google Cloud","items":[{"url":"#overview","title":"Overview"},{"url":"#task-1---use-google-cloud-function-to-import-log-data-into-google-bigquery","title":"Task 1 - Use Google Cloud Function to import log data into Google BigQuery","items":[{"url":"#clone-and-deploy-a-google-cloud-function","title":"Clone and deploy a Google Cloud Function"},{"url":"#add-fields-in-google-cloud-function","title":"Add fields in Google Cloud Function"},{"url":"#add-fields-in-bigquery","title":"Add fields in BigQuery"}]},{"url":"#task-2---analyze-log-data-with-google-data-studio","title":"Task 2 - Analyze log data with Google Data Studio","items":[{"url":"#about-the-cloudflare-logs-insights-template","title":"About the Cloudflare Logs Insights Template"},{"url":"#create-a-report-based-on-the-insights-template","title":"Create a report based on the Insights Template"},{"url":"#refreshing-fields-and-filters-manually","title":"Refreshing fields and filters manually","items":[{"url":"#update-data-studio-with-new-fields","title":"Update Data Studio with new fields"},{"url":"#fix-invalid-metric-or-dimension-errors","title":"Fix invalid metric or dimension errors"},{"url":"#update-data-filters","title":"Update data filters"}]}]}]}]},"parent":{"modifiedTime":"2022-01-19","relativePath":"data-products/analytics-integrations/google-cloud/index.md"}}},"staticQueryHashes":["2814688963","32046230","338033027","598566803","811020565"]}