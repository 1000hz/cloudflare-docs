{"expireTime":9007200899183232000,"key":"gatsby-plugin-mdx-entire-payload-ebb461d13ae1342359aa06f2170af8b6-","val":{"mdast":{"type":"root","children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"Call sequence","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":16,"offset":16},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":16,"offset":16},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The API call examples in this site illustrate the ","position":{"start":{"line":4,"column":1,"offset":18},"end":{"line":4,"column":51,"offset":68},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"recommended sequence","position":{"start":{"line":4,"column":53,"offset":70},"end":{"line":4,"column":73,"offset":90},"indent":[]}}],"position":{"start":{"line":4,"column":51,"offset":68},"end":{"line":4,"column":75,"offset":92},"indent":[]}},{"type":"text","value":" of calling the two APIs (","position":{"start":{"line":4,"column":75,"offset":92},"end":{"line":4,"column":101,"offset":118},"indent":[]}},{"type":"inlineCode","value":"/filters","position":{"start":{"line":4,"column":101,"offset":118},"end":{"line":4,"column":111,"offset":128},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":4,"column":111,"offset":128},"end":{"line":4,"column":116,"offset":133},"indent":[]}},{"type":"inlineCode","value":"/firewall/rules","position":{"start":{"line":4,"column":116,"offset":133},"end":{"line":4,"column":133,"offset":150},"indent":[]}},{"type":"text","value":").","position":{"start":{"line":4,"column":133,"offset":150},"end":{"line":4,"column":135,"offset":152},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":18},"end":{"line":4,"column":135,"offset":152},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The image below depicts this sequence, which can be applied for creating and editing rules. The reverse would apply for delete operations.","position":{"start":{"line":6,"column":1,"offset":154},"end":{"line":6,"column":139,"offset":292},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":154},"end":{"line":6,"column":139,"offset":292},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"../images/recommended-flow.png","alt":"Recommended flow","position":{"start":{"line":8,"column":1,"offset":294},"end":{"line":8,"column":52,"offset":345},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":294},"end":{"line":8,"column":52,"offset":345},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Cloudflare recommends this sequence because it facilitates filter reusability and allows working with either API independently. Thanks to the standalone nature of Cloudflare Filters, the same filter can be shared in multiple Firewall Rules as well as in other future Cloudflare products and features.","position":{"start":{"line":10,"column":1,"offset":347},"end":{"line":10,"column":301,"offset":647},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":347},"end":{"line":10,"column":301,"offset":647},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For example, a filter that matches all traffic for your API (that is, ","position":{"start":{"line":12,"column":1,"offset":649},"end":{"line":12,"column":71,"offset":719},"indent":[]}},{"type":"inlineCode","value":"http.request.uri.path matches \"^/api/.*$\"","position":{"start":{"line":12,"column":71,"offset":719},"end":{"line":12,"column":114,"offset":762},"indent":[]}},{"type":"text","value":") may disable caching, disable human CAPTCHAs, configure JSON custom errors, and appear in a Firewall Rule. With the recommended sequence above, you would just repeat steps 3-6 for every Cloudflare feature to configure against the same filter created in steps 1-2.","position":{"start":{"line":12,"column":114,"offset":762},"end":{"line":12,"column":378,"offset":1026},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":649},"end":{"line":12,"column":378,"offset":1026},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"However, for a ","position":{"start":{"line":14,"column":1,"offset":1028},"end":{"line":14,"column":16,"offset":1043},"indent":[]}},{"type":"inlineCode","value":"POST","position":{"start":{"line":14,"column":16,"offset":1043},"end":{"line":14,"column":22,"offset":1049},"indent":[]}},{"type":"text","value":" operation, the ","position":{"start":{"line":14,"column":22,"offset":1049},"end":{"line":14,"column":38,"offset":1065},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"simplified sequence","position":{"start":{"line":14,"column":40,"offset":1067},"end":{"line":14,"column":59,"offset":1086},"indent":[]}}],"position":{"start":{"line":14,"column":38,"offset":1065},"end":{"line":14,"column":61,"offset":1088},"indent":[]}},{"type":"text","value":" — shown below — allows you to create both a filter and rule in the same call. In this case, the filter and rule only refer to each other.","position":{"start":{"line":14,"column":61,"offset":1088},"end":{"line":14,"column":199,"offset":1226},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1028},"end":{"line":14,"column":199,"offset":1226},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"../images/simple-flow.png","alt":"Simple flow","position":{"start":{"line":16,"column":1,"offset":1228},"end":{"line":16,"column":42,"offset":1269},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":1228},"end":{"line":16,"column":42,"offset":1269},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In this sequence, a single ","position":{"start":{"line":18,"column":1,"offset":1271},"end":{"line":18,"column":28,"offset":1298},"indent":[]}},{"type":"inlineCode","value":"POST","position":{"start":{"line":18,"column":28,"offset":1298},"end":{"line":18,"column":34,"offset":1304},"indent":[]}},{"type":"text","value":" request to the ","position":{"start":{"line":18,"column":34,"offset":1304},"end":{"line":18,"column":50,"offset":1320},"indent":[]}},{"type":"inlineCode","value":"/firewall/rules","position":{"start":{"line":18,"column":50,"offset":1320},"end":{"line":18,"column":67,"offset":1337},"indent":[]}},{"type":"text","value":" endpoint takes the filter object in the JSON to create the filter in the Filters API (also via a ","position":{"start":{"line":18,"column":67,"offset":1337},"end":{"line":18,"column":165,"offset":1435},"indent":[]}},{"type":"inlineCode","value":"POST","position":{"start":{"line":18,"column":165,"offset":1435},"end":{"line":18,"column":171,"offset":1441},"indent":[]}},{"type":"text","value":" request). If successful, the Firewall Rule is created.","position":{"start":{"line":18,"column":171,"offset":1441},"end":{"line":18,"column":226,"offset":1496},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1271},"end":{"line":18,"column":226,"offset":1496},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Below is an example call and response using this method:","position":{"start":{"line":20,"column":1,"offset":1498},"end":{"line":20,"column":57,"offset":1554},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1498},"end":{"line":20,"column":57,"offset":1554},"indent":[]}},{"type":"code","lang":"json","meta":null,"value":"---\nheader: Request\n---\ncurl -X POST \\\n\"https://api.cloudflare.com/client/v4/zones/<ZONE_ID>/firewall/rules\" \\\n-H \"X-Auth-Email: <EMAIL>\" \\\n-H \"X-Auth-Key: <API_KEY>\" \\\n-H \"Content-Type: application/json\" \\\n-d '[\n  {\n    \"filter\": {\n      \"expression\": \"http.request.uri.path contains \\\"/api/\\\" and ip.src eq 93.184.216.34\"\n    },\n    \"action\": \"block\"\n  }\n]' ","position":{"start":{"line":22,"column":1,"offset":1556},"end":{"line":39,"column":4,"offset":1928},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"json","meta":null,"value":"---\nheader: Response\n---\n{\n  \"result\": [\n    {\n      \"id\": \"<RULE_ID>\",\n      \"paused\": false,\n      \"action\": \"block\",\n      \"priority\": null,\n      \"filter\": {\n        \"id\": \"<FILTER_ID>\",\n        \"expression\": \"http.request.uri.path contains \\\"/api/\\\" and ip.src eq 93.184.216.34\",\n        \"paused\": false\n      }\n    }\n  ],\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}","position":{"start":{"line":41,"column":1,"offset":1930},"end":{"line":63,"column":4,"offset":2323},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"However, this approach has some disadvantages:","position":{"start":{"line":65,"column":1,"offset":2325},"end":{"line":65,"column":47,"offset":2371},"indent":[]}}],"position":{"start":{"line":65,"column":1,"offset":2325},"end":{"line":65,"column":47,"offset":2371},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The Firewall Rules client has to implement error and exception handling for every potential failure occurring in both the Firewall Rules and the filters APIs.","position":{"start":{"line":67,"column":3,"offset":2375},"end":{"line":67,"column":161,"offset":2533},"indent":[]}}],"position":{"start":{"line":67,"column":3,"offset":2375},"end":{"line":67,"column":161,"offset":2533},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":2373},"end":{"line":67,"column":161,"offset":2533},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To protect against accidentally modifying or deleting filters used by other Cloudflare features, the ","position":{"start":{"line":68,"column":3,"offset":2536},"end":{"line":68,"column":104,"offset":2637},"indent":[]}},{"type":"inlineCode","value":"PUT","position":{"start":{"line":68,"column":104,"offset":2637},"end":{"line":68,"column":109,"offset":2642},"indent":[]}},{"type":"text","value":" or ","position":{"start":{"line":68,"column":109,"offset":2642},"end":{"line":68,"column":113,"offset":2646},"indent":[]}},{"type":"inlineCode","value":"DELETE","position":{"start":{"line":68,"column":113,"offset":2646},"end":{"line":68,"column":121,"offset":2654},"indent":[]}},{"type":"text","value":" operations are not allowed.","position":{"start":{"line":68,"column":121,"offset":2654},"end":{"line":68,"column":149,"offset":2682},"indent":[]}}],"position":{"start":{"line":68,"column":3,"offset":2536},"end":{"line":68,"column":149,"offset":2682},"indent":[]}}],"position":{"start":{"line":68,"column":1,"offset":2534},"end":{"line":68,"column":149,"offset":2682},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":2373},"end":{"line":68,"column":149,"offset":2682},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"By default, if either the filter or rule is invalid, neither will be created.","position":{"start":{"line":70,"column":1,"offset":2684},"end":{"line":70,"column":78,"offset":2761},"indent":[]}}],"position":{"start":{"line":70,"column":1,"offset":2684},"end":{"line":70,"column":78,"offset":2761},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"However, one exception applies. If you have exceeded your rule quota, the filter could be created while creating the rule may fail. This is because the rule is created after the filter in the sequence diagram and so, we learn of the quota being exceeded after the filter was created.","position":{"start":{"line":72,"column":1,"offset":2763},"end":{"line":72,"column":284,"offset":3046},"indent":[]}}],"position":{"start":{"line":72,"column":1,"offset":2763},"end":{"line":72,"column":284,"offset":3046},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After you resolve the issue of exceeding your quota or requesting a feature that is unavailable to your zone, return to the recommended flow to create a rule that references the filter.","position":{"start":{"line":74,"column":1,"offset":3048},"end":{"line":74,"column":186,"offset":3233},"indent":[]}}],"position":{"start":{"line":74,"column":1,"offset":3048},"end":{"line":74,"column":186,"offset":3233},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In summary, we strongly recommend the sequence with the two API calls. Limit your rule and filter creation using the simplified sequence for emergency situations, and only via ","position":{"start":{"line":76,"column":1,"offset":3235},"end":{"line":76,"column":177,"offset":3411},"indent":[]}},{"type":"inlineCode","value":"curl","position":{"start":{"line":76,"column":177,"offset":3411},"end":{"line":76,"column":183,"offset":3417},"indent":[]}},{"type":"text","value":" requests.","position":{"start":{"line":76,"column":183,"offset":3417},"end":{"line":76,"column":193,"offset":3427},"indent":[]}}],"position":{"start":{"line":76,"column":1,"offset":3235},"end":{"line":76,"column":193,"offset":3427},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Call sequence\",\"pcx-content-type\":\"reference\",\"order\":497}","position":{"start":{"line":79,"column":1,"offset":3430},"end":{"line":79,"column":97,"offset":3526},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":79,"column":97,"offset":3526}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Call sequence\",\n  \"pcx-content-type\": \"reference\",\n  \"order\": 497\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"call-sequence\"\n  }, \"Call sequence\"), mdx(\"p\", null, \"The API call examples in this site illustrate the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"recommended sequence\"), \" of calling the two APIs (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/filters\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/firewall/rules\"), \").\"), mdx(\"p\", null, \"The image below depicts this sequence, which can be applied for creating and editing rules. The reverse would apply for delete operations.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"441px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/d6f059753d3f1ae91fa2eb424d395809/efc6e/recommended-flow.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"84.10404624277457%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAABWklEQVQ4y42T6XJFQBCF5/2fzz9LKWKLPYggyJdplLi5kVN15/ZM9+md8jxvnud1XZdl4XzTCIIgjuOmacqyFNWh9X3/RSPLMsXvTO66bhiGV41pmtq2XU/o+5534eNXYSpkAfK7Bl444Z/JXD80UEFU4zgSc9ZAJ44+NdYnQCVOVaeR57lt25ZlhWHIlcRw/AeZkN9kyiCNaQevnOLiaMTTyPydLUSmGVR1T6afRKvrOtSg+bzS0n+RGV2vwVRxRLbo8MXLfc1Ij+5xDJnz157LXLZuE7PbQXASJm3XdR3HoRDaiQG5oELmZENkFoo70vQTvDAt5odpmqaM0DAMHMnystGyeduSXBKDjOklbczkWlXVDbkoCpFJjckdBIBqI2Mn/pYdyFRomiYJQ6PgKIqSJKEKImHPN7eRUdMneRUg8ygzR8C1bD6CRCKy7N91w45hPA7pMBN3CF95Nd2A3EesJgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Recommended flow\",\n    \"title\": \"Recommended flow\",\n    \"src\": \"/static/d6f059753d3f1ae91fa2eb424d395809/efc6e/recommended-flow.png\",\n    \"srcSet\": [\"/static/d6f059753d3f1ae91fa2eb424d395809/8f77f/recommended-flow.png 346w\", \"/static/d6f059753d3f1ae91fa2eb424d395809/efc6e/recommended-flow.png 441w\"],\n    \"sizes\": \"(max-width: 441px) 100vw, 441px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Cloudflare recommends this sequence because it facilitates filter reusability and allows working with either API independently. Thanks to the standalone nature of Cloudflare Filters, the same filter can be shared in multiple Firewall Rules as well as in other future Cloudflare products and features.\"), mdx(\"p\", null, \"For example, a filter that matches all traffic for your API (that is, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri.path matches \\\"^/api/.*$\\\"\"), \") may disable caching, disable human CAPTCHAs, configure JSON custom errors, and appear in a Firewall Rule. With the recommended sequence above, you would just repeat steps 3-6 for every Cloudflare feature to configure against the same filter created in steps 1-2.\"), mdx(\"p\", null, \"However, for a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST\"), \" operation, the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"simplified sequence\"), \" \\u2014 shown below \\u2014 allows you to create both a filter and rule in the same call. In this case, the filter and rule only refer to each other.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"441px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/03988a01aeab919f46e5bb7a826e2638/efc6e/simple-flow.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"59.248554913294804%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABHElEQVQoz32SWY7DMAxDff8zBgMkafZ9su99DYvAmCnKD8OWTIqSbTzP2/f9PM/jOFh/L4RhGEVR27ZlWSqlbNd1vu8HQfB4PLIsM3me2+S+7+d5TtM0juNt2+CfFsZxTJLEdV1KFkVhlmURTWAPeRgGVFjJ2mTkiLCqhtG90QLpqqp+LuCQSwSnadLKfUwRRMuIMFvQDYLruiLEBnW6lRGCjIO5vMh/bAtMgZpN0yBEb1hwHIcIR9SJaBaGw38yigx8vXBn2RBHl6a+VUaRqXKP2VAfn/SpZwM80LvyRzIFlYZPw/ApRdvbBXTfZNrgfP+E+zOolOzZzlml9SLXdY029e9ps5dVBkN7HDUnPQSmEEX927Rl5yNI6Z2fcd64WFN7EPwAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Simple flow\",\n    \"title\": \"Simple flow\",\n    \"src\": \"/static/03988a01aeab919f46e5bb7a826e2638/efc6e/simple-flow.png\",\n    \"srcSet\": [\"/static/03988a01aeab919f46e5bb7a826e2638/8f77f/simple-flow.png 346w\", \"/static/03988a01aeab919f46e5bb7a826e2638/efc6e/simple-flow.png 441w\"],\n    \"sizes\": \"(max-width: 441px) 100vw, 441px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"In this sequence, a single \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST\"), \" request to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/firewall/rules\"), \" endpoint takes the filter object in the JSON to create the filter in the Filters API (also via a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST\"), \" request). If successful, the Firewall Rule is created.\"), mdx(\"p\", null, \"Below is an example call and response using this method:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"---\\nheader: Request\\n---\\ncurl -X POST \\\\\\n\\\"https://api.cloudflare.com/client/v4/zones/<ZONE_ID>/firewall/rules\\\" \\\\\\n-H \\\"X-Auth-Email: <EMAIL>\\\" \\\\\\n-H \\\"X-Auth-Key: <API_KEY>\\\" \\\\\\n-H \\\"Content-Type: application/json\\\" \\\\\\n-d '[\\n  {\\n    \\\"filter\\\": {\\n      \\\"expression\\\": \\\"http.request.uri.path contains \\\\\\\"/api/\\\\\\\" and ip.src eq 93.184.216.34\\\"\\n    },\\n    \\\"action\\\": \\\"block\\\"\\n  }\\n]' \\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"---\\nheader: Response\\n---\\n{\\n  \\\"result\\\": [\\n    {\\n      \\\"id\\\": \\\"<RULE_ID>\\\",\\n      \\\"paused\\\": false,\\n      \\\"action\\\": \\\"block\\\",\\n      \\\"priority\\\": null,\\n      \\\"filter\\\": {\\n        \\\"id\\\": \\\"<FILTER_ID>\\\",\\n        \\\"expression\\\": \\\"http.request.uri.path contains \\\\\\\"/api/\\\\\\\" and ip.src eq 93.184.216.34\\\",\\n        \\\"paused\\\": false\\n      }\\n    }\\n  ],\\n  \\\"success\\\": true,\\n  \\\"errors\\\": [],\\n  \\\"messages\\\": []\\n}\\n\")), mdx(\"p\", null, \"However, this approach has some disadvantages:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The Firewall Rules client has to implement error and exception handling for every potential failure occurring in both the Firewall Rules and the filters APIs.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"To protect against accidentally modifying or deleting filters used by other Cloudflare features, the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"PUT\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"DELETE\"), \" operations are not allowed.\")), mdx(\"p\", null, \"By default, if either the filter or rule is invalid, neither will be created.\"), mdx(\"p\", null, \"However, one exception applies. If you have exceeded your rule quota, the filter could be created while creating the rule may fail. This is because the rule is created after the filter in the sequence diagram and so, we learn of the quota being exceeded after the filter was created.\"), mdx(\"p\", null, \"After you resolve the issue of exceeding your quota or requesting a feature that is unavailable to your zone, return to the recommended flow to create a rule that references the filter.\"), mdx(\"p\", null, \"In summary, we strongly recommend the sequence with the two API calls. Limit your rule and filter creation using the simplified sequence for emergency situations, and only via \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"curl\"), \" requests.\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"Call sequence\",\n  \"pcx-content-type\": \"reference\",\n  \"order\": 497\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1 {...{\n      \"id\": \"call-sequence\"\n    }}>{`Call sequence`}</h1>\n    <p>{`The API call examples in this site illustrate the `}<strong parentName=\"p\">{`recommended sequence`}</strong>{` of calling the two APIs (`}<inlineCode parentName=\"p\">{`/filters`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`/firewall/rules`}</inlineCode>{`).`}</p>\n    <p>{`The image below depicts this sequence, which can be applied for creating and editing rules. The reverse would apply for delete operations.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"441px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/d6f059753d3f1ae91fa2eb424d395809/efc6e/recommended-flow.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"84.10404624277457%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAABWklEQVQ4y42T6XJFQBCF5/2fzz9LKWKLPYggyJdplLi5kVN15/ZM9+md8jxvnud1XZdl4XzTCIIgjuOmacqyFNWh9X3/RSPLMsXvTO66bhiGV41pmtq2XU/o+5534eNXYSpkAfK7Bl444Z/JXD80UEFU4zgSc9ZAJ44+NdYnQCVOVaeR57lt25ZlhWHIlcRw/AeZkN9kyiCNaQevnOLiaMTTyPydLUSmGVR1T6afRKvrOtSg+bzS0n+RGV2vwVRxRLbo8MXLfc1Ij+5xDJnz157LXLZuE7PbQXASJm3XdR3HoRDaiQG5oELmZENkFoo70vQTvDAt5odpmqaM0DAMHMnystGyeduSXBKDjOklbczkWlXVDbkoCpFJjckdBIBqI2Mn/pYdyFRomiYJQ6PgKIqSJKEKImHPN7eRUdMneRUg8ygzR8C1bD6CRCKy7N91w45hPA7pMBN3CF95Nd2A3EesJgAAAABJRU5ErkJggg==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"Recommended flow\",\n            \"title\": \"Recommended flow\",\n            \"src\": \"/static/d6f059753d3f1ae91fa2eb424d395809/efc6e/recommended-flow.png\",\n            \"srcSet\": [\"/static/d6f059753d3f1ae91fa2eb424d395809/8f77f/recommended-flow.png 346w\", \"/static/d6f059753d3f1ae91fa2eb424d395809/efc6e/recommended-flow.png 441w\"],\n            \"sizes\": \"(max-width: 441px) 100vw, 441px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`Cloudflare recommends this sequence because it facilitates filter reusability and allows working with either API independently. Thanks to the standalone nature of Cloudflare Filters, the same filter can be shared in multiple Firewall Rules as well as in other future Cloudflare products and features.`}</p>\n    <p>{`For example, a filter that matches all traffic for your API (that is, `}<inlineCode parentName=\"p\">{`http.request.uri.path matches \"^/api/.*$\"`}</inlineCode>{`) may disable caching, disable human CAPTCHAs, configure JSON custom errors, and appear in a Firewall Rule. With the recommended sequence above, you would just repeat steps 3-6 for every Cloudflare feature to configure against the same filter created in steps 1-2.`}</p>\n    <p>{`However, for a `}<inlineCode parentName=\"p\">{`POST`}</inlineCode>{` operation, the `}<strong parentName=\"p\">{`simplified sequence`}</strong>{` — shown below — allows you to create both a filter and rule in the same call. In this case, the filter and rule only refer to each other.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"441px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/03988a01aeab919f46e5bb7a826e2638/efc6e/simple-flow.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"59.248554913294804%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABHElEQVQoz32SWY7DMAxDff8zBgMkafZ9su99DYvAmCnKD8OWTIqSbTzP2/f9PM/jOFh/L4RhGEVR27ZlWSqlbNd1vu8HQfB4PLIsM3me2+S+7+d5TtM0juNt2+CfFsZxTJLEdV1KFkVhlmURTWAPeRgGVFjJ2mTkiLCqhtG90QLpqqp+LuCQSwSnadLKfUwRRMuIMFvQDYLruiLEBnW6lRGCjIO5vMh/bAtMgZpN0yBEb1hwHIcIR9SJaBaGw38yigx8vXBn2RBHl6a+VUaRqXKP2VAfn/SpZwM80LvyRzIFlYZPw/ApRdvbBXTfZNrgfP+E+zOolOzZzlml9SLXdY029e9ps5dVBkN7HDUnPQSmEEX927Rl5yNI6Z2fcd64WFN7EPwAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"Simple flow\",\n            \"title\": \"Simple flow\",\n            \"src\": \"/static/03988a01aeab919f46e5bb7a826e2638/efc6e/simple-flow.png\",\n            \"srcSet\": [\"/static/03988a01aeab919f46e5bb7a826e2638/8f77f/simple-flow.png 346w\", \"/static/03988a01aeab919f46e5bb7a826e2638/efc6e/simple-flow.png 441w\"],\n            \"sizes\": \"(max-width: 441px) 100vw, 441px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`In this sequence, a single `}<inlineCode parentName=\"p\">{`POST`}</inlineCode>{` request to the `}<inlineCode parentName=\"p\">{`/firewall/rules`}</inlineCode>{` endpoint takes the filter object in the JSON to create the filter in the Filters API (also via a `}<inlineCode parentName=\"p\">{`POST`}</inlineCode>{` request). If successful, the Firewall Rule is created.`}</p>\n    <p>{`Below is an example call and response using this method:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`---\nheader: Request\n---\ncurl -X POST \\\\\n\"https://api.cloudflare.com/client/v4/zones/<ZONE_ID>/firewall/rules\" \\\\\n-H \"X-Auth-Email: <EMAIL>\" \\\\\n-H \"X-Auth-Key: <API_KEY>\" \\\\\n-H \"Content-Type: application/json\" \\\\\n-d '[\n  {\n    \"filter\": {\n      \"expression\": \"http.request.uri.path contains \\\\\"/api/\\\\\" and ip.src eq 93.184.216.34\"\n    },\n    \"action\": \"block\"\n  }\n]' \n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`---\nheader: Response\n---\n{\n  \"result\": [\n    {\n      \"id\": \"<RULE_ID>\",\n      \"paused\": false,\n      \"action\": \"block\",\n      \"priority\": null,\n      \"filter\": {\n        \"id\": \"<FILTER_ID>\",\n        \"expression\": \"http.request.uri.path contains \\\\\"/api/\\\\\" and ip.src eq 93.184.216.34\",\n        \"paused\": false\n      }\n    }\n  ],\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\n`}</code></pre>\n    <p>{`However, this approach has some disadvantages:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The Firewall Rules client has to implement error and exception handling for every potential failure occurring in both the Firewall Rules and the filters APIs.`}</li>\n      <li parentName=\"ul\">{`To protect against accidentally modifying or deleting filters used by other Cloudflare features, the `}<inlineCode parentName=\"li\">{`PUT`}</inlineCode>{` or `}<inlineCode parentName=\"li\">{`DELETE`}</inlineCode>{` operations are not allowed.`}</li>\n    </ul>\n    <p>{`By default, if either the filter or rule is invalid, neither will be created.`}</p>\n    <p>{`However, one exception applies. If you have exceeded your rule quota, the filter could be created while creating the rule may fail. This is because the rule is created after the filter in the sequence diagram and so, we learn of the quota being exceeded after the filter was created.`}</p>\n    <p>{`After you resolve the issue of exceeding your quota or requesting a feature that is unavailable to your zone, return to the recommended flow to create a rule that references the filter.`}</p>\n    <p>{`In summary, we strongly recommend the sequence with the two API calls. Limit your rule and filter creation using the simplified sequence for emergency situations, and only via `}<inlineCode parentName=\"p\">{`curl`}</inlineCode>{` requests.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}