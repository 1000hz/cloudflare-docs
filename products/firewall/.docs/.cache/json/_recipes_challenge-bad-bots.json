{"data":{"mdx":{"id":"e59c28c2-d94f-5162-9aa5-f188c185919e","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"pcx-content-type\": \"configuration\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"challenge-bad-bots\"\n  }, \"Challenge bad bots\"), mdx(Aside, {\n    type: \"warning\",\n    header: \"Important\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"Access to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/bots/get-started/bm-subscription\"\n  }, \"Bot Management\"), \" requires a Cloudflare Enterprise plan with Bot Management enabled.\")), mdx(\"p\", null, \"Cloudflare\\u2019s Bot Management feature scores the likelihood that a request originates from a bot.\"), mdx(\"p\", null, \"Scores range from 1 through 99. Low scores indicate the request comes from a script, API service, or an automated agent. High scores indicate that a human issued the request from a standard desktop or mobile web browser.\"), mdx(\"p\", null, \"These examples use:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"cf.bot_management.score\"), \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/fields/#dynamic-fields\"\n  }, \"dynamic field\"), \" to target requests from bots\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"cf.bot_management.verified_bot\"), \" to identify requests from \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"/known-issues-and-faq#bots-currently-detected\"\n  }, \"known good bots\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"cf.bot_management.ja3_hash\"), \" to target specific \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://developers.cloudflare.com/bots/concepts/ja3-fingerprint\"\n  }, \"JA3 Fingerprints\"))), mdx(\"h2\", {\n    \"id\": \"suggested-rules\"\n  }, \"Suggested rules\"), mdx(\"p\", null, \"For best results:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://developers.cloudflare.com/bots/get-started/bm-subscription#enable-bot-management-for-enterprise\"\n  }, \"Bot Analytics\"), \" to learn about your traffic before applying rules\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Start small and increase your bot threshold over time\")), mdx(\"p\", null, \"Your rules may also vary based on the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/bots/get-started/bm-subscription#5-create-additional-firewall-rules\"\n  }, \"nature of your site\"), \" and your tolerance for false positives.\"), mdx(\"h3\", {\n    \"id\": \"protect-browser-endpoints\"\n  }, \"Protect browser endpoints\"), mdx(\"p\", null, \"When a request is definitely automated (score of 1) or likely automated (scores 2 through 29) and is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" on the list of known good bots, Cloudflare \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"blocks\"), \" the request.\"), mdx(\"table\", {\n    style: {\n      \"tableLayout\": \"fixed\",\n      \"width\": \"100%\"\n    }\n  }, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Expression\"), mdx(\"th\", {\n    style: {\n      \"width\": \"20%\"\n    }\n  }, \"Action\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"code\", null, \"(cf.bot_management.score lt 30) and not (cf.bot_management.verified_bot)\")), mdx(\"td\", null, mdx(\"em\", null, \"Block\"))))), mdx(\"h3\", {\n    \"id\": \"exempt-api-traffic\"\n  }, \"Exempt API traffic\"), mdx(\"p\", null, \"Since Bot Management detects automated users, you need to explicitly allow your \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"good\"), \" automated traffic\\u2060 \\u2014 this includes your APIs and partner APIs.\"), mdx(\"p\", null, \"This example offers the same protection as the browser-only rule, but allows automated traffic to your API.\"), mdx(\"table\", {\n    style: {\n      \"tableLayout\": \"fixed\",\n      \"width\": \"100%\"\n    }\n  }, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Expression\"), mdx(\"th\", {\n    style: {\n      \"width\": \"20%\"\n    }\n  }, \"Action\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"code\", null, \"(cf.bot_management.score lt 30) and not (cf.bot_management.verified_bot) and not (http.request.uri.path contains \\\"/api\\\")\")), mdx(\"td\", null, mdx(\"em\", null, \"Block\"))))), mdx(\"h3\", {\n    \"id\": \"adjust-for-mobile-traffic\"\n  }, \"Adjust for mobile traffic\"), mdx(\"p\", null, \"Since Bot Management can be more sensitive to mobile traffic, you may want to add in additional logic to avoid blocking legitimate requests.\"), mdx(\"p\", null, \"If you are handling requests from your own mobile application, you could potentially allow it based on its specific \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/bots/concepts/ja3-fingerprint\"\n  }, \"JA3 fingerprint\"), \".\"), mdx(\"table\", {\n    style: {\n      \"tableLayout\": \"fixed\",\n      \"width\": \"100%\"\n    }\n  }, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Expression\"), mdx(\"th\", {\n    style: {\n      \"width\": \"20%\"\n    }\n  }, \"Action\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"code\", null, \"(cf.bot_management.ja3_hash eq df669e7ea913f1ac0c0cce9a201a2ec1)\")), mdx(\"td\", null, mdx(\"em\", null, \"Allow\"))))), mdx(\"p\", null, \"Otherwise, you could set lower thresholds for mobile traffic. The following rules would block definitely automated mobile traffic and challenge likely automated traffic.\"), mdx(\"table\", {\n    style: {\n      \"tableLayout\": \"fixed\",\n      \"width\": \"100%\"\n    }\n  }, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Expression\"), mdx(\"th\", {\n    style: {\n      \"width\": \"20%\"\n    }\n  }, \"Action\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"code\", null, \"(cf.bot_management.score lt 2) and (http.user_agent contains \\\"App_Name 2.0\\\")\")), mdx(\"td\", null, mdx(\"em\", null, \"Block\"))), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"code\", null, \"(cf.bot_management.score lt 30) and (http.user_agent contains \\\"App_Name 2.0\\\")\")), mdx(\"td\", null, mdx(\"em\", null, \"Challenge\"))))), mdx(\"h3\", {\n    \"id\": \"layer-rules\"\n  }, \"Layer rules\"), mdx(\"p\", null, \"If your domain saw mobile, browser, and API traffic, you would want to arrange these example rules in the following order:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"API\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Mobile:\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If consistent JA3 fingerprint, set \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Allow\"), \" rule.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If not, put the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Block\"), \" rule first and then the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Challenge\"), \" rule.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Browser - Block\")), mdx(\"h3\", {\n    \"id\": \"static-resource-protection\"\n  }, \"Static resource protection\"), mdx(\"p\", null, \"Static resources are protected by default when you create \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Firewall Rules\"), \" using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cf.bot_management.score\"), \".\"), mdx(\"p\", null, \"To exclude static resources, include \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"not (cf.botManagement.staticResource)\"), \" as part of your Firewall Rule. For more details, refer to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/bots/about/static-resources\"\n  }, \"Static resource protection\"), \".\"), mdx(\"h3\", {\n    \"id\": \"additional-considerations\"\n  }, \"Additional considerations\"), mdx(\"p\", null, \"From there, you could customize your Firewall Rules based on specific request paths (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/login\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/signup\"), \"), common traffic patterns, or many other characteristics.\"), mdx(\"p\", null, \"Just make sure to set aside time to review \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/bots/bot-analytics/bm-subscription\"\n  }, \"Bot Analytics\"), \" and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/waf/analytics\"\n  }, \"Firewall Events\"), \" to check if your rules need additional tuning.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"","type":null,"updated":null}}},"pageContext":{"id":"e59c28c2-d94f-5162-9aa5-f188c185919e","fields":{"slug":"/recipes/challenge-bad-bots"},"frontmatter":{"title":"","type":null,"order":null,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Challenge bad bots","depth":1}],"tableOfContents":{"items":[{"url":"#challenge-bad-bots","title":"Challenge bad bots","items":[{"url":"#suggested-rules","title":"Suggested rules","items":[{"url":"#protect-browser-endpoints","title":"Protect browser endpoints"},{"url":"#exempt-api-traffic","title":"Exempt API traffic"},{"url":"#adjust-for-mobile-traffic","title":"Adjust for mobile traffic"},{"url":"#layer-rules","title":"Layer rules"},{"url":"#static-resource-protection","title":"Static resource protection"},{"url":"#additional-considerations","title":"Additional considerations"}]}]}]},"parent":{"modifiedTime":"2022-02-09","relativePath":"recipes/challenge-bad-bots.md"}}}