{"data":{"mdx":{"id":"ff859631-7799-5b66-b4f3-dc53427155c9","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"pcx-content-type\": \"reference\",\n  \"order\": 640\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Definitions = makeShortcode(\"Definitions\");\nvar Type = makeShortcode(\"Type\");\nvar ParamType = makeShortcode(\"ParamType\");\nvar Aside = makeShortcode(\"Aside\");\nvar PropMeta = makeShortcode(\"PropMeta\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"functions\"\n  }, \"Functions\"), mdx(\"p\", null, \"The Cloudflare Firewall Rules language provides functions for manipulating and validating values in an expression:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#transformation-functions\"\n  }, \"Transformation functions\"), \" manipulate values extracted from an HTTP request.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#hmac-validation\"\n  }, \"HMAC Validation function\"), \" tests the validity of an HMAC token. Use it to write expressions that target requests based on the presence of a valid HMAC token.\")), mdx(\"h2\", {\n    \"id\": \"transformation-functions\"\n  }, \"Transformation functions\"), mdx(\"p\", null, \"The Cloudflare Firewall Rules language supports several functions that transform values extracted from HTTP requests. A common use case for transformation functions is the conversion of a string of characters to uppercase or lowercase, since by default, string evaluation is case sensitive.\"), mdx(\"p\", null, \"For example, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lower()\"), \" function converts all uppercase characters in a string to lowercase.\"), mdx(\"p\", null, \"In the expression below, the\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lower()\"), \" function transforms \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.host\"), \" values to lowercase so that they match the target value \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"www.cloudflare.com\\\"\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, \"lower(http.host) == \\\"www.cloudflare.com\\\"\\n\")), mdx(\"p\", null, \"Transformation functions that do not take arrays as an argument type require the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"[*]\"), \" special index notation. Refer to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/cf-firewall-language/values#arrays\"\n  }, \"Arrays\"), \" for more information.\"), mdx(\"p\", null, \"The Cloudflare Firewall Rules language supports these transformation functions:\"), mdx(Definitions, {\n    mdxType: \"Definitions\"\n  }, mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"any(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Array\"), '<', mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"Boolean\"), '>', \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Boolean\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"true\"), \" when the comparison operator in the argument returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" for \", mdx(\"em\", null, \"any\"), \" of the values in the argument array. Returns \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"false\"), \" otherwise.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\",\n    style: {\n      \"width\": \"100%\"\n    }\n  }, \"any(url_decode(http.request.body.form.values[*])[*] contains \\\"an xss attack\\\")\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"all(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Array\"), '<', mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"Boolean\"), '>', \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Boolean\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"true\"), \" when the comparison operator in the argument returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" for \", mdx(\"em\", null, \"all\"), \" values in the argument array. Returns \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"false\"), \" otherwise.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"all(http.request.headers['content-type'][*] == \\\"application/json\\\")\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"concat(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String | Integer | bytes | Array elements\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Takes a comma-separated list of values. Concatenates the argument values into a single String.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"concat(\\\"String1\\\",\\\" \\\",\\\"String\\\",2) == \\\"String1 String2\\\"\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"ends_with(source\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \", substring\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Boolean\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" when the source ends with a given substring. Returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \" otherwise. The source cannot be a literal value (for example, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"foo\\\"\"), \").\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Example:\"), mdx(\"br\", null), \"\\nIf \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri.path\"), \" is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"/welcome.html\\\"\"), \", then \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ends_with(http.request.uri.path, \\\".html\\\")\"), \" will return \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \".\"), mdx(Aside, {\n    type: \"warning\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Warning:\"), \" You can only use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ends_with()\"), \" function in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/\"\n  }, \"rulesets\"), \" and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/rules/transform\"\n  }, \"Transform Rules\"), \".\"))))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"len(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String | bytes\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Integer\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns the byte length of a String or Bytes field.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"len(http.host)\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"lower(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Converts a string field to lowercase. Only uppercase ASCII bytes are converted. All other bytes are unaffected.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"lower(http.host) == \\\"www.cloudflare.com\\\"\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"regex_replace(source\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \", regular_expression\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \", replacement\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Replaces a part of a source string matched by a regular expression with a replacement string, returning the result. The replacement string can contain references to regular expression capture groups.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Examples:\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Literal match replace:\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace(\\\"/foo/bar\\\", \\\"/bar$\\\", \\\"/baz\\\") == \\\"/foo/baz\\\"\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"If there is no match, the input string does not change:\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace(\\\"/x\\\", \\\"^/y$\\\", \\\"/mumble\\\") == \\\"/x\\\"\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Match is case sensitive by default:\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace(\\\"/foo\\\", \\\"^/FOO$\\\", \\\"/x\\\") == \\\"/foo\\\"\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"When there are multiple matches, only one replacement occurs (the first one):\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace(\\\"/a/a\\\", \\\"/a\\\", \\\"/b\\\") == \\\"/b/a\\\"\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Escape a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"$\"), \" in the replacement string by prefixing it with another \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"$\"), \":\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace(\\\"/b\\\", \\\"^/b$\\\", \\\"/b$$\\\") == \\\"/b$\\\"\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Replace with capture groups:\", mdx(\"br\", null), \"\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace(\\\"/foo/a/path\\\", \\\"^/foo/([^/]*)/(.*)$\\\", \\\"/bar/${2}/${1}\\\") == \\\"/bar/path/a/\\\"\")), mdx(Aside, {\n    type: \"warning\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Warning:\"), \" You can only use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"regex_replace()\"), \" function in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/rules/transform\"\n  }, \"rewrite expressions of Transform Rules\"), \". Additionally, the first argument must be a field under \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.headers\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \".\"))))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"remove_bytes(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"bytes\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"bytes\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns a new byte array with all the occurrences of the given bytes removed.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"remove_bytes(http.host, \\\"\\\\x2e\\\\x77\\\") == \\\"cloudflarecom\\\"\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"starts_with(source\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \", substring\", mdx(ParamType, {\n    mdxType: \"ParamType\"\n  }, \"String\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Boolean\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" when the source starts with a given substring. Returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \" otherwise. The source cannot be a literal value (for example, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"foo\\\"\"), \").\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Example:\"), mdx(\"br\", null), \"\\nIf \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri.path\"), \" is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\\\"/blog/first-post\\\"\"), \", then \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"starts_with(http.request.uri.path, \\\"/blog\\\")\"), \" will return \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \".\"), mdx(Aside, {\n    type: \"warning\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Warning:\"), \" You can only use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"starts_with()\"), \" function in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/\"\n  }, \"rulesets\"), \" and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/rules/transform\"\n  }, \"Transform Rules\"), \".\"))))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"to_string(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Integer | Boolean | IP address\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Returns the string representation of an Integer, Boolean, or IP address value.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Examples:\")), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"to_string(cf.bot_management.score) == '5'\\nto_string(ssl) == 'true'\\n\")), mdx(Aside, {\n    type: \"warning\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Warning:\"), \" You can only use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"to_string()\"), \" function in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/rules/transform\"\n  }, \"rewrite expressions of Transform Rules\"), \".\"))))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"upper(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Converts a string field to uppercase. Only lowercase ASCII bytes are converted. All other bytes are unaffected.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"upper(http.host) == \\\"WWW.CLOUDFLARE.COM\\\"\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"url_decode(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Decodes a URL formatted string, as in the following:\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"%20\"), \" and \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"+\"), \" decode to space characters \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \" \")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"%E4%BD\"), \" decodes to \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"\\xE4\\xBD \")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", null, \"Example:\"), mdx(\"br\", null), mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"any(url_decode(http.request.body.form.values[*])[*] contains \\\"an xss attack\\\")\")))))), mdx(\"h2\", {\n    \"id\": \"magic-firewall-functions\"\n  }, \"Magic Firewall Functions\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", null, \"bit_slice(\", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\"), \", \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Number\"), \", \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Number\"), \")\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Number\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Select a slice of contiguous bits from a string field. This is primarily intended for use with \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"ip\"), \" and \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"tcp\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The slice can be no longer than 31 bits, but multiple calls can be joined together via a logical expression.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use of structure fields is preferred over this mechanism.\")))), mdx(\"h2\", {\n    \"id\": \"hmac-validation\"\n  }, \"HMAC validation\"), mdx(Aside, {\n    type: \"warning\",\n    header: \"Important\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"Access to the HMAC validation function requires a Cloudflare Pro, Business, or Enterprise plan.\")), mdx(\"h3\", {\n    \"id\": \"overview\"\n  }, \"Overview\"), mdx(\"p\", null, \"You can validate hash-based message authentication code (HMAC) tokens in a Firewall Rules expression by using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"is_timed_hmac_valid_v0()\"), \" function, which has this signature:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"is_timed_hmac_valid_v0(\\n  <String literal as Key>,\\n  <String field as MessageMAC>,\\n  <Integer literal as ttl>,\\n  <Integer as currentTimeStamp>,\\n  <Optional Integer literal as lengthOfSeparator, default: 0>,\\n  <Optional String literal as flags>\\n) -> <Bool as result>\\n\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"is_timed_hmac_valid_v0()\"), \" function has these parameter definitions:\"), mdx(Definitions, {\n    mdxType: \"Definitions\"\n  }, mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Key\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String literal\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Specifies the secret cryptographic key for validating the HMAC.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"MessageMAC\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Contains a concatenation of these HMAC elements: \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"message\"), \", \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"separator\"), \", \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"timestamp\"), \", \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"mac\"), \". For a definition and an example, see \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#messagemac\"\n  }, mdx(\"em\", {\n    parentName: \"a\"\n  }, \"MessageMAC\")), \".\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ttl\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Integer literal\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Defines the time-to-live for the HMAC token, expressed in seconds. Determines how long the token is valid, relative to the time it was issued.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"currentTimeStamp\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Integer\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Represents the Unix timestamp when Cloudflare received the request, expressed in seconds. Pass the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"http.request.timestamp.sec\"), \" field as an approximate value to this argument.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"lengthOfSeparator\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"Integer literal\"), \" \", mdx(PropMeta, {\n    mdxType: \"PropMeta\"\n  }, \"optional\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Specifies the length of the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"separator\"), \" between the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"timestamp\"), \" and the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"message\"), \" in the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"MessageMAC\"), \". Expressed in bytes, with a default value of 0.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"flags\"), \" \", mdx(Type, {\n    mdxType: \"Type\"\n  }, \"String literal\"), \" \", mdx(PropMeta, {\n    mdxType: \"PropMeta\"\n  }, \"optional\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"When you set this optional argument to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"'s'\"), \", the function expects the value of the base64-encoded \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mac\"), \" in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"MessageMAC\"), \" argument to use the URL-safe character set with no padding.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"When you do \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" set the value of \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"flags\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"'s'\"), \", you must URL encode the base64 value for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mac\"), \" in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"MessageMAC\"), \" argument.\")))))), mdx(\"h3\", {\n    \"id\": \"usage\"\n  }, \"Usage\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"is_timed_hmac_valid_v0()\"), \" function uses the supplied \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Key\"), \" to generate a message authentication code (MAC) from the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"message\"), \" and the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"timestamp\"), \" regions of the MessageMAC. When the generated MAC matches the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mac\"), \" region of the MessageMAC and the token has not expired, the HMAC is valid and the function returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \".\"), mdx(\"p\", null, \"For example, the following expression matches requests to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"download.example.com\"), \" that do not include valid HMAC tokens:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"http.host == \\\"download.example.com\\\"\\nand not is_timed_hmac_valid_v0(\\\"mysecretkey\\\", http.request.uri, 100000, http.request.timestamp.sec, 8)\\n\")), mdx(\"p\", null, \"To review examples of firewall rules that use HMAC validation, see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/recipes/\"\n  }, mdx(\"em\", {\n    parentName: \"a\"\n  }, \"Common use cases\")), \".\"), mdx(\"h3\", {\n    \"id\": \"messagemac\"\n  }, \"MessageMAC\"), mdx(\"p\", null, \"A valid MessageMAC satisfies the regular expression\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"(.+)(.*)(\\\\d{10})-(.{43,})\\n\")), mdx(\"p\", null, \"and is composed of these parentheses-delimited expressions:\"), mdx(\"table\", null, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Expression\"), mdx(\"th\", {\n    style: {\n      \"width\": \"50%\"\n    }\n  }, \"Description\"), mdx(\"th\", null, \"Example\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", null, \"(.+)\")), mdx(\"td\", null, \"The \", mdx(\"em\", null, \"message\"), \" to validate\"), mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"/download/cat.jpg\"))), mdx(\"tr\", null, mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", null, \"(.*)\")), mdx(\"td\", null, \"The \", mdx(\"em\", null, \"separator\"), \" between message and timestamp, commonly a parameter name\"), mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"&verify=\"))), mdx(\"tr\", null, mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", null, \"(\\\\d\", '{10}', \")\")), mdx(\"td\", null, \"The 10-digit Unix \", mdx(\"em\", null, \"timestamp\"), \" when the MAC was issued, expressed in seconds\"), mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"1484063137\"))), mdx(\"tr\", null, mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", null, \"(.\", '{43,}', \")\")), mdx(\"td\", null, mdx(\"p\", null, \"A base64-encoded version of the \", mdx(\"em\", null, \"MAC\"), \". When you do not set the value of the \", mdx(\"em\", null, \"urlSafe\"), \" argument in the HMAC validation function to \", mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"'s'\"), \", you must URL encode the base64 value for \", mdx(\"em\", null, \"mac\"), \".\"), mdx(\"p\", null, \"When the base64 MAC encoding is URL-safe, the value for \", mdx(\"em\", null, \"mac\"), \" contains 43 bytes. Otherwise, the value will be 44 bytes or more, because of URL encoding.\")), mdx(\"td\", {\n    valign: \"top\"\n  }, mdx(\"code\", {\n    className: \"InlineCode\"\n  }, \"IaLGSmELTvlhfd0ItdN6PhhHTFhzx\", mdx(\"br\", null), \"73EX8uy%2FcSDiIU%3D\"))))), mdx(\"p\", null, \"For details on generating a MessageMAC, see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://support.cloudflare.com/hc/articles/115001376488#6P9Gz7kmyxQrpL6r6iPKQR\"\n  }, mdx(\"em\", {\n    parentName: \"a\"\n  }, \"Implement token creation\")), \".\"), mdx(\"h2\", {\n    \"id\": \"hmac-validation-examples\"\n  }, \"HMAC validation examples\"), mdx(Aside, {\n    type: \"warning\",\n    header: \"Important\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"When you do not use the optional \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"flags\"), \" argument for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"is_timed_hmac_valid_v0()\"), \", you must URL encode the base64 value for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mac\"), \" in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"MessageMAC\"), \" argument.\"), mdx(\"p\", null, \"For more information, see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#overview\"\n  }, \"HMAC Validation: Overview\"), \".\")), mdx(\"h3\", {\n    \"id\": \"simple-case\"\n  }, \"Simple case\"), mdx(\"p\", null, \"Consider the case where the MessageMAC is contained entirely within a single field, as in this example URI path:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-http\"\n  }, \"/download/cat.jpg?verify=1484063787-IaLGSmELTvlhfd0ItdN6PhhHTFhzx73EX8uy%2FcSDiIU%3D\\n\")), mdx(\"p\", null, \"Note how the URI maps to the elements of the MessageMAC:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"message\"), \": \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/download/cat.jpg\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"separator\"), \": \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"?verify=\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"timestamp\"), \": \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"1484063787\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"mac\"), \": \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"IaLGSmELTvlhfd0ItdN6PhhHTFhzx73EX8uy%2FcSDiIU%3D\"))), mdx(\"p\", null, \"When the MessageMAC is contained entirely within a single field such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \", using the validation function is straightforward. Pass the name of the field to the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"MessageMAC\"), \" argument:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"is_timed_hmac_valid_v0(\\n  \\\"mysecretkey\\\",\\n  http.request.uri,\\n  100000,\\n  http.request.timestamp.sec,\\n  8\\n)\\n\")), mdx(\"h3\", {\n    \"id\": \"concatenated-messagemac-argument\"\n  }, \"Concatenated MessageMAC argument\"), mdx(\"p\", null, \"To compose a MessageMAC from more than one field, use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"concat()\"), \" function.\"), mdx(\"p\", null, \"This example constructs the MessageMAC by concatenating the request URI and two header fields:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"is_timed_hmac_valid_v0(\\n  \\\"mysecretkey\\\",\\n  concat(\\n    http.request.uri,\\n    http.request.headers[\\\"timestamp\\\"][0],\\n    \\\"-\\\",\\n    http.request.headers[\\\"mac\\\"][0]),\\n  100000,\\n  http.request.timestamp.sec,\\n  0\\n)\\n\")), mdx(\"p\", null, \"For more on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"concat()\"), \" usage, see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#transformation-functions\"\n  }, mdx(\"em\", {\n    parentName: \"a\"\n  }, \"Transformation functions\")), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"","type":null,"updated":null}}},"pageContext":{"id":"ff859631-7799-5b66-b4f3-dc53427155c9","fields":{"slug":"/cf-firewall-language/functions"},"frontmatter":{"title":"","type":null,"order":640,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Functions","depth":1}],"tableOfContents":{"items":[{"url":"#functions","title":"Functions","items":[{"url":"#transformation-functions","title":"Transformation functions"},{"url":"#magic-firewall-functions","title":"Magic Firewall Functions"},{"url":"#hmac-validation","title":"HMAC validation","items":[{"url":"#overview","title":"Overview"},{"url":"#usage","title":"Usage"},{"url":"#messagemac","title":"MessageMAC"}]},{"url":"#hmac-validation-examples","title":"HMAC validation examples","items":[{"url":"#simple-case","title":"Simple case"},{"url":"#concatenated-messagemac-argument","title":"Concatenated MessageMAC argument"}]}]}]},"parent":{"modifiedTime":"2021-12-17","relativePath":"cf-firewall-language/functions.md"}}}